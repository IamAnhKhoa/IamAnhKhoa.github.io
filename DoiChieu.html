<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gi√°m s√°t BHYT To√†n di·ªán - Merry Christmas</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"/>
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2966/2966327.png" type="image/png" sizes="32x32"/>
    <script type="text/javascript" src="https://gc.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=rK1ZFGwl_O7zNUV95EDaDdGXB9R5nhEAaI0nEbOxqJ5yEthcXJcAwDjSXojs_43p" charset="UTF-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

    <style>
        /* Global Styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
             font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
             background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
             min-height: 100vh;
             padding: 20px;
             line-height: 1.6;
         }
        .container {
             max-width: 1800px;
             margin: 0 auto;
             background: white;
             border-radius: 20px;
             box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
             overflow: hidden;
         }
        .header { background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%); color: white; padding: 30px; text-align: center; position: relative; overflow: hidden;}
        .header::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); opacity: 0.5; animation: rotate 20s linear infinite; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; position: relative; z-index: 1; }
        .header p { font-size: 1.2em; opacity: 0.9; position: relative; z-index: 1; }
        .tab-nav { display: flex; background: #f8f9fa; border-bottom: 3px solid #dee2e6; }
        .tab-button { flex: 1; padding: 20px 30px; border: none; background: transparent; font-size: 1.1em; font-weight: 600; color: #6c757d; cursor: pointer; transition: all 0.3s ease; position: relative; }
        .tab-button:hover { background: rgba(102, 126, 234, 0.1); color: #667eea; transform: translateY(-2px); }
        .tab-button.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); }
        .tab-content { display: none; padding: 30px; animation: fadeIn 0.5s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px; }
        .stats-overview { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 15px; text-align: center; box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3); transition: transform 0.3s ease; }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-card h3 { font-size: 2.5em; margin-bottom: 10px; font-weight: 700; }
        .stat-card p { font-size: 1.1em; opacity: 0.9; }
        .chart-container { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); height: 400px; }
        .advanced-filters { background: linear-gradient(135deg, #f8f9ff 0%, #e6f3ff 100%); border-radius: 15px; padding: 30px; margin: 30px 0; border: 2px solid rgba(102, 126, 234, 0.1); }
        .filter-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .filter-header h3 { color: #2c3e50; font-size: 1.4em; }
        .settings-btn { background: none; border: none; font-size: 1.6em; cursor: pointer; color: #6c757d; transition: color 0.3s, transform 0.3s ease; padding: 0; line-height: 1; }
        .settings-btn:hover { transform: rotate(45deg); color: #667eea; }
        .filter-toggle { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; }
        .filter-toggle:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        .filter-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 25px; }
        .filter-group { display: flex; flex-direction: column; gap: 8px; }
        .filter-group label { font-weight: 600; color: #2c3e50; font-size: 0.95em; }
        .filter-input, .filter-select { padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 10px; font-size: 1em; transition: all 0.3s ease; background: white; }
        .filter-input:focus, .filter-select:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        .date-range-group { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .filter-actions { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }
        .btn { padding: 12px 25px; border: none; border-radius: 25px; font-size: 1em; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-success { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; }
        .btn-info { background: linear-gradient(135deg, #17a2b8 0%, #117a8b 100%); color: white; }
        .btn-warning { background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%); color: white; }
        .btn-danger { background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .upload-area { border: 3px dashed #667eea; border-radius: 15px; padding: 50px 30px; text-align: center; background: linear-gradient(135deg, #f8f9ff 0%, #e6f3ff 100%); margin-bottom: 30px; transition: all 0.3s ease; }
        .upload-area:hover { border-color: #764ba2; background: linear-gradient(135deg, #e6f3ff 0%, #d4edda 100%); }
        .upload-area.drag-over { border-color: #28a745; background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); transform: scale(1.02); }
        .file-input-wrapper { position: relative; display: inline-block; margin-top: 20px; }
        .file-input { position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer; }
        .file-button { padding: 15px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 25px; font-weight: 600; border: none; transition: all 0.3s ease; }
        .file-button:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        .results-container { background: white; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: hidden; margin-top: 30px; }
        .table-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center; }
        .results-table { width: 100%; border-collapse: collapse; }
        .results-table th { background: #f8f9fa; padding: 15px; text-align: left; font-weight: 600; color: #2c3e50; border-bottom: 2px solid #dee2e6; }
        .results-table td { padding: 15px; border-bottom: 1px solid #dee2e6; transition: background-color 0.3s ease; vertical-align: top; }
        .results-table tr { cursor: pointer; }
        .results-table tr:hover { background: rgba(102, 126, 234, 0.05); }
        .results-table tr.has-xml4 { background-color: #f0fff0; }
        .results-table tr.has-xml4:hover { background: rgba(102, 234, 150, 0.2); }
        .xml4-indicator::before { content: 'üìÑ '; font-size: 1.1em; }
        .results-table .error-detail { margin-bottom: 5px; }
        .comparator-details ul { padding-left: 20px; margin: 0; font-size: 0.9em; }
        .comparator-details li { color: #c53030; }
        .copyable { cursor: copy; text-decoration: underline; text-decoration-style: dotted; color: #3182ce; }
        .copyable:hover { color: #2c5282; }
        .status-badge { display: inline-block; padding: 6px 12px; border-radius: 20px; font-size: 0.85em; font-weight: 600; margin: 2px; }
        .status-success { background: #d4edda; color: #155724; }
        .status-warning { background: #fff3cd; color: #856404; }
        .status-error { background: #f8d7da; color: #721c24; }
        .status-mismatch { background: #f8d7da; color: #721c24; }
        .status-match { background: #d4edda; color: #155724; }
        .status-xml-only { background: #d1ecf1; color: #0c5460; }
        .status-excel-only { background: #e2e3e5; color: #383d41; }
        .loading { display: none; text-align: center; padding: 50px; }
        .loading.show { display: block; }
        .spinner { width: 60px; height: 60px; border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @media (max-width: 768px) { .dashboard-grid, .filter-grid { grid-template-columns: 1fr; } .tab-nav, .filter-actions { flex-direction: column; } }
        .pagination { padding: 20px; text-align: center; background: #f8f9fa; display: flex; justify-content: center; align-items: center; gap: 10px; }
        .pagination button { padding: 8px 15px; border: 1px solid #dee2e6; background: white; cursor: pointer; border-radius: 5px; transition: all 0.3s ease; }
        .pagination button:hover:not(:disabled) { background: #667eea; color: white; transform: translateY(-2px); }
        .pagination button:disabled { opacity: 0.5; cursor: not-allowed; }
        .pagination .page-info { margin: 0 15px; font-weight: 600; color: #2c3e50; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(5px); }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 25px; border: 1px solid #888; width: 80%; max-width: 1200px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); animation: fadeInScale 0.4s ease-out; }
        @keyframes fadeInScale { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; padding-bottom: 15px; margin-bottom: 20px; }
        .modal-header h2 { margin: 0; font-size: 1.8em; color: #2c3e50; }
        .close-button { color: #aaa; font-size: 32px; font-weight: bold; cursor: pointer; transition: color 0.3s ease; }
        .close-button:hover, .close-button:focus { color: #333; }
        #xml4DetailsTableContainer, #settingsModalBody { max-height: 60vh; overflow-y: auto; }
        .modal-footer { text-align: right; border-top: 1px solid #eee; padding-top: 20px; margin-top: 10px; }
        .summary-modal-content { margin: 15% auto; width: 90%; max-width: 550px; }
        .summary-modal-body { display: flex; flex-direction: column; gap: 15px; padding: 20px 0; }
        .summary-item { display: flex; align-items: center; font-size: 1.2em; }
        .summary-item .icon { font-size: 1.5em; margin-right: 15px; width: 30px; text-align: center; }
        .summary-item .icon-total { color: #667eea; }
        .summary-item .icon-error { color: #dc3545; }
        .summary-item .icon-valid { color: #28a745; }
        .summary-item .text { font-weight: 500; }
        .summary-item .value { margin-left: auto; font-weight: 700; background: #f1f3f5; padding: 5px 12px; border-radius: 20px; }
        .settings-modal-content { max-width: 800px; }
        #settingsTable th, #settingsTable td { padding: 12px 15px; vertical-align: middle; }
        #settingsTable .switch { position: relative; display: inline-block; width: 50px; height: 24px; }
        #settingsTable .switch input { opacity: 0; width: 0; height: 0; }
        #settingsTable .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; }
        #settingsTable .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        #settingsTable input:checked + .slider { background-color: #28a745; }
        #settingsTable input:disabled + .slider { background-color: #aaa; cursor: not-allowed; }
        #settingsTable input:checked + .slider:before { transform: translateX(26px); }
        #vacationList ul { max-height: 400px; overflow-y: auto; padding: 10px; border: 1px solid #e1e8ed; border-radius: 8px; }
        #vacationList li { display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; border-bottom: 1px solid #f1f3f5; }
        #vacationList li:last-child { border-bottom: none; }
        #vacationList li button { padding: 4px 10px; border: 1px solid #dc3545; background-color: #f8d7da; color: #721c24; border-radius: 5px; cursor: pointer; transition: all 0.2s ease; }
        #vacationList li button:hover { background-color: #dc3545; color: white; }
    </style>

    <style>
        .theme-toggle{ position:absolute; right:18px; top:18px; border:none; background: rgba(255,255,255,.12); color:#fff; width:56px; height:40px; border-radius:12px; cursor:pointer; display:grid; place-items:center; backdrop-filter: blur(6px); box-shadow:0 10px 25px rgba(0,0,0,.18); transition: transform .15s ease, box-shadow .2s ease; z-index: 10; }
        .theme-toggle:hover{ transform: translateY(-2px); box-shadow: 0 14px 30px rgba(0,0,0,.22); }
        .theme-toggle .icon{ font-size:1.1rem; }
        .theme-toggle .icon-moon{ display:none; }
        body.dark .theme-toggle .icon-sun{ display:none; }
        body.dark .theme-toggle .icon-moon{ display:block; }
        .results-table td, .results-table tr { transition: background-color .15s ease, transform .12s ease, box-shadow .12s ease; }
        .results-table tr:has(.status-badge.status-error):hover { background: rgba(220,53,69,.10) !important; box-shadow: inset 0 0 0 2px rgba(220,53,69,.45); transform: translateY(-1px); }
        .results-table tr:has(.status-badge.status-warning):hover { background: rgba(255,193,7,.14) !important; box-shadow: inset 0 0 0 2px rgba(255,193,7,.45); transform: translateY(-1px); }
        .results-table tr.row-errorish:hover { background: rgba(220,53,69,.10) !important; box-shadow: inset 0 0 0 2px rgba(220,53,69,.45); transform: translateY(-1px); }
        .results-table tr.row-warningish:hover { background: rgba(255,193,7,.14) !important; box-shadow: inset 0 0 0 2px rgba(255,193,7,.45); transform: translateY(-1px); }
        body.dark { background: linear-gradient(135deg, #111827 0%, #0f172a 100%); color:#e5e7eb; }
        body.dark .container { background:#0b1220; box-shadow: 0 24px 70px rgba(0,0,0,.5); }
        body.dark .header { background: linear-gradient(135deg, #0f172a 0%, #1f2937 100%); }
        body.dark .tab-nav { background:#0b1220; border-bottom-color:#243244; }
        body.dark .tab-button { color:#a0aec0; }
        body.dark .tab-button:hover { background: rgba(99,102,241,.12); color:#c7d2fe; }
        body.dark .tab-button.active { color:white; box-shadow: 0 6px 18px rgba(99,102,241,.35) inset, 0 8px 22px rgba(99,102,241,.25); }
        body.dark .chart-container, body.dark .results-container { background:#0f172a; box-shadow: 0 12px 28px rgba(0,0,0,.45); }
        body.dark .results-table th { background:#0b1220; color:#e5e7eb; border-bottom-color:#243244; }
        body.dark .results-table td { border-bottom-color:#243244; }
        body.dark .advanced-filters { background: linear-gradient(135deg,#0b1220 0%,#0f172a 100%); border-color:#1f2a3a; }
        body.dark .filter-input, body.dark .filter-select { background:#0b1220; color:#e5e7eb; border-color:#243244; }
        body.dark .upload-area { background: linear-gradient(135deg,#0b1220 0%,#0f172a 100%); border-color:#3b82f6; }
        body.dark .table-header { background: linear-gradient(135deg,#4f46e5 0%,#7c3aed 100%); }
        body.dark .pagination { background:#0b1220; }
        /* Style cho Animation Icon */
        .summary-item .icon { position: relative; display: inline-block; }
        @keyframes sparkle { 0%, 100% { filter: drop-shadow(0 0 2px gold) drop-shadow(0 0 6px gold); transform: rotate(0deg); } 50% { filter: drop-shadow(0 0 4px gold) drop-shadow(0 0 12px gold); transform: rotate(10deg); } }
        @keyframes fly { 0% { transform: translateX(0) translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateX(80px) translateY(-40px) rotate(30deg); opacity: 0; } }
        @keyframes bounceHappy { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.25); } }
        .icon-money.sparkle { animation: sparkle 1.2s infinite ease-in-out; }
        .icon-money.fly::after { content: "üí∏"; position: absolute; left: 0; top: 0; animation: fly 0.8s ease-out forwards; pointer-events: none; }
        .icon-money.happy { animation: bounceHappy 0.8s infinite; }
    </style>

    <style>
        /* ƒê·ªãnh nghƒ©a b·∫£ng m√†u Noel */
        :root {
            --noel-red: #d63031;        /* ƒê·ªè r·ª±c r·ª° */
            --noel-green: #00b894;      /* Xanh l√° th√¥ng */
            --noel-dark-green: #165b33; /* Xanh ƒë·∫≠m */
            --noel-gold: #fdcb6e;       /* V√†ng chu√¥ng */
        }

        /* Thay ƒë·ªïi n·ªÅn Body sang ƒë·ªè Gi√°ng sinh nh∆∞ng v·∫´n d·ªÖ ch·ªãu */
        body:not(.dark) {
            background: linear-gradient(135deg, #a80000 0%, #d63031 100%);
        }

        /* C·∫≠p nh·∫≠t Header v·ªõi ·∫£nh b·∫°n g·ª≠i */
        .header {
            /* Overlay m√†u ƒëen m·ªù ƒë·ªÉ ch·ªØ d·ªÖ ƒë·ªçc h∆°n */
            background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.6)), url('https://tinhocnews.com/wp-content/uploads/2024/08/backgroung-giang-sinh.jpg') !important;
            background-size: cover !important;
            background-position: center !important;
            border-bottom: 5px solid var(--noel-gold);
        }
        
        /* Hi·ªáu ·ª©ng ch·ªØ Noel cho ti√™u ƒë·ªÅ */
        .header h1 {
            text-shadow: 2px 2px 4px #000;
        }
        .header h1::before { content: "üéÖ "; }
        .header h1::after { content: " üéÑ"; }

        /* ƒê·ªïi m√†u N√∫t b·∫•m ch√≠nh (Primary) sang m√†u Xanh l√° th√¥ng */
        .btn-primary, .tab-button.active, .filter-toggle, .file-button {
            background: linear-gradient(135deg, var(--noel-dark-green) 0%, var(--noel-green) 100%) !important;
            border: 1px solid #fff !important;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn-primary:hover, .file-button:hover {
            box-shadow: 0 0 15px var(--noel-gold) !important;
        }

        /* ƒê·ªïi m√†u th·∫ª Th·ªëng k√™ (Stat Cards) */
        /* Card 1: ƒê·ªè */
        .stat-card:nth-child(1) { background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%) !important; border: 1px solid var(--noel-gold); }
        /* Card 2: Xanh */
        .stat-card:nth-child(2) { background: linear-gradient(135deg, #16a085 0%, #1abc9c 100%) !important; border: 1px solid var(--noel-gold); }
        /* Card 3: V√†ng cam */
        .stat-card:nth-child(3) { background: linear-gradient(135deg, #d35400 0%, #e67e22 100%) !important; border: 1px solid var(--noel-gold); }
        /* Card 4: T√≠m (gi·ªØ l·∫°i 1 ch√∫t m√†u c≈© cho ƒë·ª° ch√≥i) */
        .stat-card:nth-child(4) { background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%) !important; border: 1px solid var(--noel-gold); }

        /* B·∫£ng k·∫øt qu·∫£: Header m√†u ƒê·ªè */
        .table-header {
            background: linear-gradient(135deg, #c0392b 0%, #d63031 100%) !important;
        }
        
        /* Loading Spinner m√†u Noel */
        .spinner {
            border-top-color: var(--noel-red) !important;
            border-left-color: var(--noel-green) !important;
        }

        /* V√πng Upload vi·ªÅn xanh ƒë·ªè */
        .upload-area {
            border-color: var(--noel-green) !important;
            background: rgba(255, 255, 255, 0.9) !important;
        }
        .upload-area:hover {
            border-color: var(--noel-red) !important;
        }
        
        /* T·∫°o hi·ªáu ·ª©ng tuy·∫øt r∆°i (CSS Class h·ªó tr·ª£ Script b√™n d∆∞·ªõi) */
        .snowflake {
            position: fixed;
            top: -10px;
            color: #fff;
            font-size: 1em;
            pointer-events: none; /* Kh√¥ng che n√∫t b·∫•m */
            z-index: 9999;
            user-select: none;
            animation: fall linear forwards;
        }
        @keyframes fall {
            to { transform: translateY(105vh); }
        }
    </style>
  <style>
    /* 1. C·∫§U H√åNH C∆† B·∫¢N & M√ÄU S·∫ÆC */
    body {
        /* M√†u ƒë·ªè Noel tr·∫ßm ·∫•m, sang tr·ªçng */
        background: linear-gradient(135deg, #8B0000 0%, #a71d31 50%, #8B0000 100%) !important;
        position: relative;
        overflow-x: hidden; /* Tr√°nh thanh cu·ªôn ngang do hi·ªáu ·ª©ng bay */
    }

    /* Container ch√≠nh: Th√™m vi·ªÅn v√†ng l·∫•p l√°nh */
    .container {
        border: 3px solid #FFD700;
        box-shadow: 0 0 30px rgba(255, 215, 0, 0.3), 0 20px 60px rgba(0, 0, 0, 0.5) !important;
        position: relative;
        z-index: 10; /* N·ªïi l√™n tr√™n tuy·∫øt */
        background: rgba(255, 255, 255, 0.98); /* N·ªÅn tr·∫Øng ƒë·ª•c nh·∫π ƒë·ªÉ d·ªÖ ƒë·ªçc ch·ªØ tr√™n n·ªÅn ƒë·ªè */
    }

    /* 2. HEADER L·∫§P L√ÅNH */
    .header {
        background: linear-gradient(135deg, #8B0000 0%, #DC143C 100%) !important;
        position: relative;
        overflow: visible !important; /* ƒê·ªÉ h√¨nh trang tr√≠ th√≤i ra ngo√†i ƒë∆∞·ª£c */
        border-bottom: 4px solid #FFD700;
        animation: christmasGlow 3s ease-in-out infinite alternate;
    }

    @keyframes christmasGlow {
        from { box-shadow: 0 0 10px rgba(255, 215, 0, 0.2); }
        to { box-shadow: 0 0 25px rgba(255, 215, 0, 0.6); }
    }

    /* Ch·ªØ ti√™u ƒë·ªÅ m·∫° v√†ng */
    .header h1 {
        background: linear-gradient(45deg, #FFD700, #FFF, #FFD700);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        font-weight: 800;
    }

    /* Trang tr√≠ Header: Santa tr√°i & C√¢y th√¥ng ph·∫£i */
    .header::before {
        content: 'üéÖ'; position: absolute; bottom: -25px; left: 20px;
        font-size: 4em; z-index: 15; filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.4));
        animation: santaWave 2s ease-in-out infinite;
    }
    .header::after {
        content: 'üéÑ'; position: absolute; bottom: -25px; right: 20px;
        font-size: 4.5em; z-index: 15; filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.4));
        animation: treeSwing 3s ease-in-out infinite;
    }

    @keyframes santaWave { 0%, 100% { transform: rotate(-10deg); } 50% { transform: rotate(10deg); } }
    @keyframes treeSwing { 0%, 100% { transform: rotate(-5deg); } 50% { transform: rotate(5deg); } }

    /* 3. HI·ªÜU ·ª®NG TUY·∫æT R∆†I & SANTA BAY (D·ª±a tr√™n CSS c·ªßa b·∫°n) */
    .snowflakes {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; z-index: 1; /* N·∫±m d∆∞·ªõi container ƒë·ªÉ v·∫´n click ƒë∆∞·ª£c n√∫t */
    }
    .snowflake {
        position: absolute; top: -20px; color: white; font-size: 1.5em;
        animation: snowfall linear infinite; opacity: 0.8;
        text-shadow: 0 0 5px white;
    }
    @keyframes snowfall {
        0% { transform: translateY(-20px) rotate(0deg); opacity: 1; }
        100% { transform: translateY(100vh) rotate(360deg); opacity: 0.2; }
    }

    /* T·∫°o ng·∫´u nhi√™n cho tuy·∫øt r∆°i t·ª± nhi√™n h∆°n */
    .snowflake:nth-child(2n) { font-size: 1em; animation-duration: 7s; animation-delay: 1s; }
    .snowflake:nth-child(2n+1) { font-size: 1.8em; animation-duration: 10s; animation-delay: 0s; }
    .snowflake:nth-child(3n) { left: 20%; animation-delay: 2s; }
    .snowflake:nth-child(3n+1) { left: 50%; animation-delay: 4s; }
    .snowflake:nth-child(3n+2) { left: 80%; animation-delay: 1s; }
    .snowflake:nth-child(5n) { left: 10%; animation-duration: 12s; }
    .snowflake:nth-child(7n) { left: 90%; animation-duration: 8s; }

    /* Santa bay ngang m√†n h√¨nh */
    .santa-sleigh-container {
        position: fixed; top: 10%; left: -20%; z-index: 9999;
        font-size: 3em; pointer-events: none;
        animation: santaFlyAcross 25s linear infinite;
        opacity: 0.9;
    }
    @keyframes santaFlyAcross {
        0% { left: -20%; transform: translateY(0) rotate(-5deg); }
        50% { transform: translateY(-20px) rotate(5deg); }
        100% { left: 120%; transform: translateY(0) rotate(-5deg); }
    }

    /* 4. C·∫¨P NH·∫¨T GIAO DI·ªÜN C√ÅC N√öT & TH·∫∫ */
    /* Tab active m√†u ƒë·ªè */
    .tab-button.active {
        color: #d63031 !important;
        border-bottom-color: #d63031 !important;
        background: rgba(255, 255, 255, 0.8);
    }
    .tab-button.active::before { content: 'üéÅ '; }

    /* Th·∫ª th·ªëng k√™ (Stat cards) */
    .stat-card {
        background: linear-gradient(135deg, #ff4757 0%, #ff6b81 100%) !important;
        border: 2px solid #FFD700;
        box-shadow: 0 5px 15px rgba(220, 20, 60, 0.4);
    }
    .stat-card h3, .stat-card p { text-shadow: 1px 1px 2px rgba(0,0,0,0.2); }

    /* C√°c n√∫t b·∫•m th√™m icon vui nh·ªôn */
    .btn { position: relative; overflow: hidden; }
    .btn-primary { background: linear-gradient(135deg, #2ed573 0%, #26de81 100%) !important; border: 1px solid #fff; } /* Xanh c√¢y th√¥ng */
    .btn-primary::before { content: 'üéÑ '; margin-right: 5px; }
    .btn-success::before { content: '‚õÑ '; margin-right: 5px; }
    
    /* Darkmode t∆∞∆°ng th√≠ch */
    body.dark { background: linear-gradient(135deg, #1e272e 0%, #000000 100%) !important; }
    body.dark .container { background: #000; border-color: #555; }
</style>
</head>
<body>
    <div class="snowflakes" aria-hidden="true">
        <div class="snowflake">‚ùÑ</div><div class="snowflake">‚ùÖ</div>
        <div class="snowflake">‚ùÜ</div><div class="snowflake">‚ùÑ</div>
        <div class="snowflake">‚ùÖ</div><div class="snowflake">‚ùÜ</div>
        <div class="snowflake">‚ùÑ</div><div class="snowflake">‚ùÖ</div>
        <div class="snowflake">‚ùÜ</div><div class="snowflake">‚ùÑ</div>
        <div class="snowflake">‚ùÖ</div><div class="snowflake">‚ùÜ</div>
    </div>

    <div class="santa-sleigh-container">üéÖüõ∑ü¶åüí®</div>

    <div style="position: fixed; bottom: 10px; width: 100%; text-align: center; pointer-events: none; z-index: 5; font-size: 1.5em; opacity: 0.7;">
        ‚õÑüéÑ‚òÉÔ∏è Ch√∫c M·ª´ng Gi√°ng Sinh & NƒÉm M·ªõi 2025 ‚òÉÔ∏èüéÑ‚õÑ
    </div>

    <div class="container">
        <header class="header">
            <h1>üè• Gi√°m s√°t BHYT To√†n di·ªán</h1>
            <p>H·ªá th·ªëng qu·∫£n l√Ω v√† ph√¢n t√≠ch d·ªØ li·ªáu BHYT v·ªõi dashboard th√¥ng minh - 79764 - IT Anh Khoa</p>
            <button id="themeToggle" class="theme-toggle" aria-label="Chuy·ªÉn Light/Dark">
              <span class="icon icon-sun">‚òÄÔ∏è</span>
              <span class="icon icon-moon">üåô</span>
            </button>
        </header>

      <nav class="tab-nav">
        <button class="tab-button" onclick="openTab(event, 'dashboardTab')">üìä Dashboard</button>
        <button class="tab-button active" onclick="openTab(event, 'validatorTab')">üìã Ki·ªÉm tra XML</button>
        <button class="tab-button" onclick="openTab(event, 'comparatorTab')">üîÑ ƒê·ªëi chi·∫øu</button>
        <button class="tab-button" onclick="openTab(event, 'denialTab')">üí∏ D·ª± ki·∫øn Xu·∫•t to√°n</button>
        <button class="tab-button" onclick="openTab(event, 'reportsTab')">üìà B√°o c√°o</button>
        <button class="tab-button" onclick="openTab(event, 'scheduleTab')">üóìÔ∏è L·ªãch ngh·ªâ</button>
      </nav>

        <div id="dashboardTab" class="tab-content">
             <div class="filter-actions" style="margin-bottom: 20px;">
                 <button class="btn btn-success" id="exportDashboardButton" onclick="exportDashboardToExcel()">üìä Xu·∫•t Excel Dashboard</button>
                 <button class="btn btn-info" onclick="exportDoctorAnalysis()">‚öïÔ∏è Xu·∫•t Ph√¢n t√≠ch NVYT</button>
             </div>
            <div class="stats-overview" id="dashboardStats">
                <div class="stat-card">
                    <h3 id="totalRecords">0</h3>
                    <p>T·ªïng h·ªì s∆°</p>
                </div>
                <div class="stat-card">
                    <h3 id="errorCount">0</h3>
                    <p>S·ªë h·ªì s∆° l·ªói</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalAmount">0</h3>
                    <p>T·ªïng chi ph√≠ BHYT TT</p>
                </div>
                 <div class="stat-card">
                    <h3 id="totalBncct">0</h3>
                    <p>T·ªïng chi ph√≠ BN CCT</p>
                </div>
            </div>
            <div class="dashboard-grid">
                <div class="chart-container"><canvas id="errorTypesChart"></canvas></div>
                <div class="chart-container"><canvas id="timelineChart"></canvas></div>
            </div>
            <div class="dashboard-grid">
                <div class="chart-container"><canvas id="departmentChart"></canvas></div>
                <div class="chart-container"><canvas id="amountChart"></canvas></div>
            </div>
             <div class="dashboard-grid">
                <div class="chart-container"><canvas id="topDrugsChart"></canvas></div>
                <div class="chart-container"><canvas id="topServicesChart"></canvas></div>
            </div>
        </div>

        <div id="validatorTab" class="tab-content active">
            <div class="upload-area" id="validatorUploadArea">
                <h2>üìÅ T·∫£i l√™n file XML BHYT</h2>
                <p>K√©o th·∫£ file XML v√†o ƒë√¢y ho·∫∑c click ƒë·ªÉ ch·ªçn file</p>
                <div class="file-input-wrapper">
                    <input type="file" class="file-input" id="validatorFileInput" accept=".xml">
                    <button class="file-button">Ch·ªçn file XML</button>
                </div>
                <div id="validatorFileInfo" style="display:none; margin-top: 15px; padding: 15px; background: rgba(40, 167, 69, 0.1); border-radius: 8px;"></div>
                <button class="btn btn-primary" id="validatorProcessButton" style="margin-top: 20px;" disabled>üöÄ B·∫Øt ƒë·∫ßu ki·ªÉm tra</button>
            </div>

            <div class="loading" id="validatorLoading">
                <div class="spinner"></div>
                <p>ƒêang x·ª≠ l√Ω file XML...</p>
            </div>

            <div class="advanced-filters" id="validatorFilters">
                <div class="filter-header">
                    <h3>üîç B·ªô l·ªçc n√¢ng cao</h3>
                    <button class="filter-toggle" onclick="toggleFilterVisibility('validatorFilters')">M·ªü r·ªông</button>
                </div>
                <div class="filter-content" style="display: none;">
                    <div class="filter-grid">
                        <div class="filter-group">
                             <div style="display: flex; justify-content: space-between; align-items: center;">
                                 <label>Lo·∫°i l·ªói:</label>
                                 <button class="settings-btn" onclick="openSettingsModal()" title="C√†i ƒë·∫∑t quy t·∫Øc ki·ªÉm tra">‚öôÔ∏è</button>
                             </div>
                            <select class="filter-select" id="errorTypeFilter">
                                <option value="">T·∫•t c·∫£ lo·∫°i l·ªói</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>M·ª©c ƒë·ªô:</label>
                            <select class="filter-select" id="severityFilter">
                                <option value="">T·∫•t c·∫£ m·ª©c ƒë·ªô</option>
                                <option value="critical">üî¥ Nghi√™m tr·ªçng</option>
                                <option value="warning">üü° C·∫£nh b√°o</option>
                                <option value="success">üü¢ H·ª£p l·ªá</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>T√¨m ki·∫øm (T√™n, M√£ LK, M√£ BN):</label>
                            <input type="text" class="filter-input" id="searchBox" placeholder="Nh·∫≠p t·ª´ kh√≥a...">
                        </div>
                        <div class="filter-group">
                            <label>T√™n B√°c sƒ© / Ng∆∞·ªùi TH:</label>
                            <input type="text" class="filter-input" id="maBsFilter" placeholder="Nh·∫≠p t√™n nh√¢n vi√™n y t·∫ø...">
                        </div>
                        <div class="filter-group">
                            <label>Kho·∫£ng th·ªùi gian v√†o vi·ªán:</label>
                            <div class="date-range-group">
                                <input type="date" class="filter-input" id="dateFromFilter">
                                <input type="date" class="filter-input" id="dateToFilter">
                            </div>
                        </div>
                        <div class="filter-group">
                            <label>Gi·ªõi t√≠nh:</label>
                            <select class="filter-select" id="genderFilter">
                                <option value="">T·∫•t c·∫£</option>
                                <option value="1">Nam</option>
                                <option value="2">N·ªØ</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>B·ªánh nh√¢n c√πng chi tr·∫£ (CCT):</label>
                            <select class="filter-select" id="bncctFilter">
                                <option value="">T·∫•t c·∫£</option>
                                <option value="yes">C√≥ CCT (> 0)</option>
                                <option value="no">Kh√¥ng c√≥ CCT (= 0)</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>L·ªçc ca c√≥ DVKT & Kh√°m:</label>
                             <select class="filter-select" id="dvktFilter">
                                <option value="">T·∫•t c·∫£</option>
                                <option value="yes">C√≥ DVKT & Kh√°m</option>
                                <option value="no">Kh√¥ng (Ch·ªâ DVKT ho·∫∑c ch·ªâ Kh√°m)</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>L·ªçc ca thi·∫øu XML4:</label>
                             <select class="filter-select" id="missingXml4Filter">
                                <option value="">T·∫•t c·∫£</option>
                                <option value="yes">C√≥ DVKT & Kh√°m nh∆∞ng thi·∫øu XML4</option>
                            </select>
                        </div>
                    </div>
                    <div class="filter-actions" style="display: none;">
                        <button class="btn btn-primary" onclick="applyFilters()">üîç √Åp d·ª•ng l·ªçc</button>
                        <button class="btn btn-warning" onclick="clearFilters()">üîÑ X√≥a b·ªô l·ªçc</button>
                        <button class="btn btn-success" onclick="exportToExcel(false)">üìä Xu·∫•t Excel (T·∫•t c·∫£)</button>
                        <button class="btn btn-danger" onclick="exportToExcel(true)">‚ö†Ô∏è Xu·∫•t Excel (Ch·ªâ L·ªói)</button>
                        <button class="btn btn-info" onclick="exportDvktPlusKham()">üìÑ Xu·∫•t Excel (DVKT & Kh√°m)</button>
                    </div>
                </div>
            </div>
            <div class="results-container" id="validatorResults" style="display: none;">
                <div class="table-header">
                    <h3>üìã K·∫øt qu·∫£ ki·ªÉm tra (Click v√†o h√†ng c√≥ bi·ªÉu t∆∞·ª£ng üìÑ ƒë·ªÉ xem chi ti·∫øt XML4)</h3>
                    <div id="resultsInfo"></div>
                </div>
                <div style="overflow-x: auto; max-height: 600px;">
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Th√¥ng tin BN</th>
                                <th>Th·ªùi gian ƒëi·ªÅu tr·ªã</th>
                                <th>Chi ph√≠</th>
                                <th>B√°c sƒ© Cƒê / Ng∆∞·ªùi TH</th>
                                <th>Tr·∫°ng th√°i</th>
                                <th>Chi ti·∫øt l·ªói</th>
                            </tr>
                        </thead>
                        <tbody id="resultsTableBody"></tbody>
                    </table>
                </div>
                <div class="pagination" id="paginationContainer"></div>
            </div>
        </div>

        <div id="comparatorTab" class="tab-content">
             <div class="upload-area">
                <h2>üîÑ ƒê·ªëi chi·∫øu XML & Excel/CSV</h2>
                <p>T·∫£i l√™n c·∫£ file XML v√† file ƒë·ªëi chi·∫øu (Excel ho·∫∑c CSV)</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px;">
                    <div>
                        <h3>üìÑ File XML BHYT</h3>
                        <div class="file-input-wrapper" style="width: 100%;">
                            <input type="file" class="file-input" id="comparatorXmlInput" accept=".xml">
                            <button class="file-button" style="width: 100%;">Ch·ªçn file XML</button>
                        </div>
                        <div id="xmlStatus" style="margin-top: 10px; font-size: 0.9em;"></div>
                    </div>
                    <div>
                        <h3>üìä File ƒë·ªëi chi·∫øu (Excel/CSV)</h3>
                        <div class="file-input-wrapper" style="width: 100%;">
                            <input type="file" class="file-input" id="comparatorExcelInput" accept=".xlsx,.xls,.csv">
                            <button class="file-button" style="width: 100%;">Ch·ªçn file Excel/CSV</button>
                        </div>
                        <div id="excelStatus" style="margin-top: 10px; font-size: 0.9em;"></div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-primary" id="compareButton" disabled>‚ö° B·∫Øt ƒë·∫ßu ƒë·ªëi chi·∫øu</button>
                </div>
            </div>
            <div class="loading" id="comparatorLoading">
                <div class="spinner"></div>
                <p>ƒêang ƒë·ªëi chi·∫øu d·ªØ li·ªáu...</p>
            </div>
            <div id="comparatorResults" style="display: none;">
                <div class="advanced-filters">
                    <div class="filter-header"><h3>üîç L·ªçc k·∫øt qu·∫£ ƒë·ªëi chi·∫øu</h3></div>
                    <div class="filter-grid">
                        <div class="filter-group">
                            <label>Tr·∫°ng th√°i:</label>
                            <select class="filter-select" id="statusFilter" onchange="applyComparatorFilters()">
                                <option value="">T·∫•t c·∫£</option>
                                <option value="match">‚úÖ Kh·ªõp</option>
                                <option value="mismatch">‚ùå Kh√¥ng kh·ªõp</option>
                                <option value="xml-only">üìÑ Ch·ªâ c√≥ trong XML</option>
                                <option value="excel-only">üìä Ch·ªâ c√≥ trong file ƒë·ªëi chi·∫øu</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>T√¨m m√£ LK:</label>
                            <input type="text" class="filter-input" id="maLkSearch" placeholder="Nh·∫≠p m√£ LK..." oninput="applyComparatorFilters()">
                        </div>
                        <div class="filter-group">
                            <label>T√¨m t√™n BN:</label>
                            <input type="text" class="filter-input" id="patientSearch" placeholder="Nh·∫≠p t√™n b·ªánh nh√¢n..." oninput="applyComparatorFilters()">
                        </div>
                    </div>
                    <div class="filter-actions">
                        <button class="btn btn-warning" onclick="clearComparatorFilters()">üîÑ X√≥a l·ªçc</button>
                        <button class="btn btn-success" onclick="exportComparatorResults()">üìä Xu·∫•t Excel</button>
                    </div>
                </div>
                <div class="results-container">
                    <div class="table-header">
                        <h3>üìã K·∫øt qu·∫£ ƒë·ªëi chi·∫øu</h3>
                        <div id="comparatorResultsInfo"></div>
                    </div>
                    <div style="overflow-x: auto; max-height: 600px;" id="comparatorResultsTableWrapper"></div>
                </div>
            </div>
        </div>

        <div id="denialTab" class="tab-content">
             <div class="advanced-filters">
                <div class="filter-header"><h3>üîç L·ªçc theo ng√†y v√†o vi·ªán</h3></div>
                <div class="filter-grid" style="grid-template-columns: 1fr 1fr;">
                     <div class="filter-group">
                        <label>T·ª´ ng√†y:</label>
                        <input type="date" class="filter-input" id="denialDateFrom">
                    </div>
                    <div class="filter-group">
                        <label>ƒê·∫øn ng√†y:</label>
                        <input type="date" class="filter-input" id="denialDateTo">
                    </div>
                </div>
                <div class="filter-actions">
                    <button class="btn btn-primary" onclick="updateDenialProjectionTab()">üîç √Åp d·ª•ng</button>
                    <button class="btn btn-warning" onclick="clearDenialFilters()">üîÑ X√≥a L·ªçc</button>
                </div>
            </div>
             <div class="stats-overview" id="denialStats">
                <div class="stat-card">
                    <h3 id="totalDeniedAmount">0</h3>
                    <p>T·ªïng ti·ªÅn d·ª± ki·∫øn xu·∫•t to√°n</p>
                </div>
                <div class="stat-card">
                    <h3 id="recordsWithDenial">0</h3>
                    <p>S·ªë h·ªì s∆° c√≥ l·ªói</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalDeniedItems">0</h3>
                    <p>S·ªë d·ªãch v·ª•/thu·ªëc b·ªã l·ªói</p>
                </div>
            </div>
            <div class="results-container" id="denialResultsContainer">
                 <div class="table-header"><h3>üìã Chi ti·∫øt c√°c m·ª•c d·ª± ki·∫øn xu·∫•t to√°n</h3></div>
                 <div style="overflow-x: auto; max-height: 600px;" id="denialResultsTableWrapper"></div>
            </div>
        </div>

        <div id="reportsTab" class="tab-content">
             <div class="advanced-filters">
                <div class="filter-header"><h3>üìä T√πy ch·ªçn b√°o c√°o</h3></div>
                <div class="filter-grid">
                    <div class="filter-group">
                        <label>Lo·∫°i b√°o c√°o:</label>
                        <select class="filter-select" id="reportType">
                            <option value="error-summary" selected>T√≥m t·∫Øt l·ªói</option>
                            <option value="time-analysis">Ph√¢n t√≠ch theo th·ªùi gian</option>
                            <option value="cost-analysis">Ph√¢n t√≠ch chi ph√≠</option>
                            <option value="department-analysis">Ph√¢n t√≠ch theo khoa</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Kho·∫£ng th·ªùi gian (Ng√†y v√†o):</label>
                        <div class="date-range-group">
                            <input type="date" class="filter-input" id="reportDateFrom">
                            <input type="date" class="filter-input" id="reportDateTo">
                        </div>
                    </div>
                </div>
                <div class="filter-actions">
                    <button class="btn btn-primary" onclick="generateReport()">üìà T·∫°o b√°o c√°o</button>
                    <button class="btn btn-success" onclick="exportReport()">üìä Xu·∫•t b√°o c√°o</button>
                </div>
            </div>
            <div class="dashboard-grid">
                <div class="chart-container" id="reportChart1Container"><canvas id="reportChart1"></canvas></div>
                <div class="chart-container" id="reportChart2Container"><canvas id="reportChart2"></canvas></div>
            </div>
        </div>
    </div>

    <div id="xml4Modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="xml4ModalTitle">Chi ti·∫øt C·∫≠n L√¢m S√†ng (XML4)</h2>
                <span class="close-button" onclick="closeXml4Modal()">&times;</span>
            </div>
            <div id="xml4DetailsTableContainer"></div>
        </div>
    </div>

    <div id="scheduleTab" class="tab-content">
    <div class="advanced-filters">
      <div class="advanced-filters" style="margin-top: 30px;">
    <div class="filter-header">
        <h3>üìÖ Xem l·ªãch ngh·ªâ theo ng√†y</h3>
    </div>
    <div class="filter-grid" style="grid-template-columns: 2fr 1fr; align-items: end;">
        <div class="filter-group">
            <label for="viewVacationByDateInput">Ch·ªçn m·ªôt ng√†y ƒë·ªÉ xem:</label>
            <input type="date" id="viewVacationByDateInput" class="filter-input">
        </div>
        <div class="filter-group">
            <button id="viewVacationByDateButton" class="btn btn-primary" style="width: 100%;">üîç Xem ai ngh·ªâ</button>
        </div>
    </div>
    <div id="vacationsByDateResult" style="margin-top: 20px;">
        </div></div><div class="results-container">
    </div>
        <div class="filter-header">
            <h3>üóìÔ∏è Thi·∫øt l·∫≠p l·ªãch ngh·ªâ c·ªßa B√°c sƒ©</h3>
        </div>
        <div class="filter-grid" style="grid-template-columns: 2fr 1fr; align-items: end;">
            <div class="filter-group">
                <label for="doctorScheduleSelect">Ch·ªçn B√°c sƒ©:</label>
                <select id="doctorScheduleSelect" class="filter-select"></select>
            </div>
            <div class="filter-group">
                <label for="vacationDate">Ch·ªçn ng√†y ngh·ªâ:</label>
                <input type="date" id="vacationDate" class="filter-input">
            </div>
            <div class="filter-actions" style="grid-column: 1 / -1;">
                 <button id="addVacationDayButton" class="btn btn-primary">‚ûï Th√™m ng√†y ngh·ªâ</button>
                 <button id="saveScheduleButton" class="btn btn-success">üíæ L∆∞u L·ªãch ngh·ªâ v√†o tr√¨nh duy·ªát</button>
                          </div>
                  </div>
    </div>

    <div class="results-container">
        <div class="table-header">
            <h3>Danh s√°ch ng√†y ngh·ªâ ƒë√£ thi·∫øt l·∫≠p</h3>
        </div>
        <div id="vacationList" style="padding: 20px;">
            <p>Vui l√≤ng ch·ªçn m·ªôt b√°c sƒ© ƒë·ªÉ xem v√† qu·∫£n l√Ω l·ªãch ngh·ªâ.</p>
        </div>
    </div></div>
    
    <div id="summaryModal" class="modal">
        <div class="modal-content summary-modal-content">
            <div class="modal-header">
                <h2>üîé K·∫øt Qu·∫£ Ki·ªÉm Tra</h2>
                <span class="close-button" onclick="closeSummaryPopup()">&times;</span>
            </div>
            <div class="summary-modal-body">
                <div class="summary-item">
                    <span class="icon icon-total">üóÇÔ∏è</span>
                    <span class="text">T·ªïng h·ªì s∆° ki·ªÉm tra:</span>
                    <span class="value" id="summaryTotal">0</span>
                </div>
                <div class="summary-item">
                    <span class="icon icon-valid">‚úîÔ∏è</span>
                    <span class="text">S·ªë h·ªì s∆° h·ª£p l·ªá:</span>
                    <span class="value" id="summaryValid">0</span>
                </div>
                <hr>
                <div class="summary-item">
                    <span class="icon icon-error">‚ùå</span>
                    <span class="text">T·ªïng s·ªë h·ªì s∆° l·ªói:</span>
                    <span class="value" id="summaryError">0</span>
                </div>
                <div class="summary-item">
                    <span class="icon icon-error" style="color: #c82333;">üî¥</span>
                    <span class="text">H·ªì s∆° l·ªói nghi√™m tr·ªçng:</span>
                    <span class="value" id="summaryCritical">0</span>
                </div>
                <div class="summary-item">
                    <span class="icon icon-error" style="color: #ffc107;">üü°</span>
                    <span class="text">H·ªì s∆° ch·ªâ c√≥ c·∫£nh b√°o:</span>
                    <span class="value" id="summaryWarningOnly">0</span>
                </div>
                <div class="summary-item">
                    <span class="icon icon-total" style="color: #dc3545;">üí∏</span>
                    <span class="text">T·ªïng ti·ªÅn d·ª± ki·∫øn XT:</span>
                    <span class="value" id="summaryDenialAmount">0</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeSummaryPopup()">OK</button>
            </div>
        </div>
    </div>
    <div id="settingsModal" class="modal">
        <div class="modal-content settings-modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è C√†i ƒë·∫∑t quy t·∫Øc ki·ªÉm tra</h2>
                <span class="close-button" onclick="closeSettingsModal()">&times;</span>
            </div>
            <div id="settingsModalBody">
                <p>T·∫°i ƒë√¢y b·∫°n c√≥ th·ªÉ b·∫≠t/t·∫Øt c√°c c·∫£nh b√°o ho·∫∑c n√¢ng c·∫•p ch√∫ng th√†nh l·ªói nghi√™m tr·ªçng ƒë·ªÉ t√≠nh v√†o xu·∫•t to√°n.</p>
                <table class="results-table" id="settingsTable">
                    <thead>
                        <tr>
                            <th>B·∫≠t/T·∫Øt</th>
                            <th>M√¥ t·∫£ quy t·∫Øc</th>
                            <th>M·ª©c ƒë·ªô</th>
                        </tr>
                    </thead>
                    <tbody id="settingsTableBody"></tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning" onclick="closeSettingsModal()">H·ªßy</button>
                <button class="btn btn-success" onclick="saveSettings()">L∆∞u & √Åp d·ª•ng l·∫°i</button>
            </div>
        </div>
    </div>

    <script>
      (function applyInitialTheme(){ try { const saved = localStorage.getItem('theme'); const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches; const useDark = saved ? saved === 'dark' : prefersDark; if (useDark) document.body.classList.add('dark'); } catch(e){} })();
      document.addEventListener('DOMContentLoaded', () => {
        const validatorBtn = document.querySelector("button[onclick*=\"'validatorTab'\"]");
        if (validatorBtn) {
          if (typeof openTab === 'function') { openTab({ currentTarget: validatorBtn }, 'validatorTab'); } 
          else { document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active')); document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active')); validatorBtn.classList.add('active'); document.getElementById('validatorTab')?.classList.add('active'); }
        }
        const toggle = document.getElementById('themeToggle');
        if (toggle) { toggle.addEventListener('click', () => { const isDark = document.body.classList.toggle('dark'); localStorage.setItem('theme', isDark ? 'dark' : 'light'); }); }
        const supportsHas = CSS.supports && CSS.supports('selector(:has(*))');
        if (!supportsHas) {
          const tbody = document.getElementById('resultsTableBody');
          if (tbody) {
            const markRows = () => { tbody.querySelectorAll('tr').forEach(tr => { tr.classList.remove('row-errorish','row-warningish'); if (tr.querySelector('.status-badge.status-error')) tr.classList.add('row-errorish'); else if (tr.querySelector('.status-badge.status-warning')) tr.classList.add('row-warningish'); }); };
            const mo = new MutationObserver(markRows); mo.observe(tbody, { childList:true, subtree:true, characterData:true }); markRows();
          }
        }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script src="script.js" defer></script>
    <script src="Support.js" defer></script>
    <script src="gemini_analysis.js" defer></script>
    <script>
      function parseVnAmount(text) { if (!text) return 0; const cleaned = String(text).replace(/[^0-9\-]/g, ''); const n = parseInt(cleaned, 10); return isNaN(n) ? 0 : n; }
      function updateMoneyIconEffect() {
        const valueEl = document.getElementById('summaryDenialAmount'); if (!valueEl) return;
        const container = valueEl.closest('.summary-item'); if (!container) return; const iconEl = container.querySelector('.icon'); if (!iconEl) return;
        const amount = parseVnAmount(valueEl.textContent);
        iconEl.classList.remove('sparkle','fly','happy','icon-money'); iconEl.classList.add('icon-money');
        if (amount > 0) { iconEl.textContent = 'üí∏'; iconEl.classList.add('sparkle'); setTimeout(() => { iconEl.classList.add('fly'); setTimeout(() => iconEl.classList.remove('fly'), 900); }, 200); } else { iconEl.textContent = 'üéâ'; iconEl.classList.add('happy'); }
      }
      document.addEventListener('DOMContentLoaded', () => {
        const val = document.getElementById('summaryDenialAmount'); if (!val) return;
        const mo = new MutationObserver(updateMoneyIconEffect); mo.observe(val, { childList: true, characterData: true, subtree: true });
        setTimeout(updateMoneyIconEffect, 300);
        const summaryModal = document.getElementById('summaryModal');
        if (summaryModal) { const modalMo = new MutationObserver(() => { const visible = window.getComputedStyle(summaryModal).display !== 'none'; if (visible) setTimeout(updateMoneyIconEffect, 150); }); modalMo.observe(summaryModal, { attributes: true, attributeFilter: ['style','class'] }); }
        window.__updateMoneyIconEffect = updateMoneyIconEffect;
      });
    </script>
    
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const snowContainer = document.createElement('div');
            snowContainer.id = 'snow-container';
            snowContainer.style.position = 'fixed';
            snowContainer.style.top = '0';
            snowContainer.style.left = '0';
            snowContainer.style.width = '100%';
            snowContainer.style.height = '100%';
            snowContainer.style.pointerEvents = 'none'; // Quan tr·ªçng: ƒê·ªÉ click xuy√™n qua tuy·∫øt
            snowContainer.style.zIndex = '9999';
            document.body.appendChild(snowContainer);

            const snowflakeChars = ['‚ùÑ', '‚ùÖ', '‚ùÜ', '‚Ä¢'];
            
            setInterval(() => {
                const snowflake = document.createElement('div');
                snowflake.classList.add('snowflake');
                snowflake.innerText = snowflakeChars[Math.floor(Math.random() * snowflakeChars.length)];
                
                // Random v·ªã tr√≠
                snowflake.style.left = Math.random() * 100 + 'vw';
                snowflake.style.animationDuration = Math.random() * 3 + 2 + 's'; 
                snowflake.style.opacity = Math.random();
                snowflake.style.fontSize = Math.random() * 10 + 10 + 'px';
                
                snowContainer.appendChild(snowflake);

                // T·ª± x√≥a sau khi r∆°i xong ƒë·ªÉ kh√¥ng n·∫∑ng m√°y
                setTimeout(() => {
                    snowflake.remove();
                }, 5000);
            }, 200); // T·∫°o tuy·∫øt m·ªói 200ms
        });
    </script>
    
    <script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"db0c89750f364ceea3cb03b0503af93a","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
</body>
</html>
