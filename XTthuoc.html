<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ph√¢n T√≠ch L√Ω Do Xu·∫•t To√°n BHYT</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 30px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .container {
            max-width: 95%;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        h1 {
            background: linear-gradient(45deg, #dc3545, #c82333);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            border-bottom: 3px solid #dc3545;
            padding-bottom: 15px;
            margin-bottom: 25px;
            font-weight: bold;
        }
        .api-config {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            border-left: 5px solid #ffc107;
            box-shadow: 0 4px 15px rgba(255,193,7,0.2);
        }
        .table thead th, .table tbody td { text-align: center; vertical-align: middle; }
        .summary-row {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .summary-row:hover {
            background: linear-gradient(135deg, #ffe6e6 0%, #ffcccb 100%);
            transform: translateX(5px);
        }
        .summary-row td:first-child { text-align: left; font-weight: bold; }
        .detail-container-row td {
            padding: 25px !important;
            background: linear-gradient(135deg, #fff5f5 0%, #ffebee 100%);
            border-radius: 10px;
        }
        .detail-table-wrapper {
            max-height: 60vh;
            overflow-y: auto;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .detail-table thead {
            position: sticky;
            top: 0;
            background: linear-gradient(135deg, #ffebee 0%, #f8d7da 100%);
            z-index: 10;
        }
        .reason-cell {
            min-width: 400px;
            text-align: left !important;
            font-weight: 500;
            font-size: 0.95em;
            padding: 15px !important;
            border-radius: 8px;
        }
        .reason-cell.rejected {
            color: #721c24;
            background: linear-gradient(135deg, #f8d7da 0%, #f1aeb5 100%);
            border-left: 4px solid #dc3545;
            box-shadow: 0 2px 8px rgba(220,53,69,0.2);
        }
        .reason-cell.analyzing {
            color: #495057;
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            border-left: 4px solid #6c757d;
        }
        .reason-cell.not-analyzed {
            color: #6c757d;
            background: #f8f9fa;
            border-left: 4px solid #dee2e6;
            font-style: italic;
        }
        .loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #dc3545;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 30px auto;
            display: none;
        }
        .ai-analyze-btn:disabled { opacity: 0.6; }
        .api-status { padding: 15px; border-radius: 8px; margin-bottom: 15px; font-weight: 500; }
        .api-status.success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .api-status.error {
            background: linear-gradient(135deg, #f8d7da 0%, #f1aeb5 100%);
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .stats-card {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px rgba(220,53,69,0.3);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .stat-item { text-align: center; }
        .stat-number { font-size: 2.5em; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .stat-label { font-size: 1em; opacity: 0.9; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .icd-tag {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
            color: #c62828;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.85em;
            margin: 2px;
            display: inline-block;
            border: 1px solid #ef5350;
            font-weight: 500;
        }
        .medicine-tag {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            color: #ef6c00;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.85em;
            margin: 2px;
            display: inline-block;
            border: 1px solid #ff9800;
            font-weight: 500;
        }
        .rejection-badge {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(220,53,69,0.3);
        }
        .header-icon { color: #dc3545; margin-right: 10px; font-size: 1.2em; }
        .btn-group-custom { gap: 10px; }
        .btn-modern {
            border-radius: 8px;
            font-weight: 500;
            padding: 8px 16px;
            transition: all 0.3s ease;
        }
        .btn-modern:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .detail-header {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }
        .filter-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .reason-header {
            background: #dc3545;
            color: white;
            padding: 8px 12px;
            border-radius: 6px 6px 0 0;
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        .reason-content {
            background: #fff;
            padding: 12px;
            border-radius: 0 0 6px 6px;
            border: 2px solid #dc3545;
            line-height: 1.6;
        }
        .analysis-summary {
            font-size: 0.95em;
            color: #495057;
            margin-top: 8px;
            padding: 10px;
            background: #f8f9fa;
            border-left: 3px solid #6c757d;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üö´ Ph√¢n T√≠ch L√Ω Do Xu·∫•t To√°n BHYT</h1>
        <div class="alert alert-danger" role="alert">
            <strong>‚ö†Ô∏è L∆∞u √Ω:</strong> H·ªá th·ªëng ph√¢n t√≠ch c√°c tr∆∞·ªùng h·ª£p ƒë√£ b·ªã BHYT t·ª´ ch·ªëi thanh to√°n (xu·∫•t to√°n) ƒë·ªÉ t√¨m ra l√Ω do chi ti·∫øt v√† c·ª• th·ªÉ.
        </div>
                
        <div class="api-config">
            <h5>üîë C·∫•u h√¨nh Gemini API</h5>
            <div class="row">
                <div class="col-md-8">
                    <input type="password" id="api-key" class="form-control" placeholder="Nh·∫≠p API Key c·ªßa Gemini (Google AI Studio)">
                </div>
                <div class="col-md-4">
                    <button type="button" id="test-api" class="btn btn-outline-warning w-100 btn-modern">Ki·ªÉm tra API</button>
                </div>
            </div>
            <small class="text-muted">
                <strong>H∆∞·ªõng d·∫´n:</strong> V√†o <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a> 
                ƒë·ªÉ t·∫°o API key mi·ªÖn ph√≠. API key ƒë∆∞·ª£c l∆∞u c·ª•c b·ªô v√† kh√¥ng chia s·∫ª.
            </small>
            <div id="api-status"></div>
        </div>

        <div class="mb-3">
            <input type="file" id="excel-file" class="form-control" accept=".xlsx, .xls">
        </div>
                
        <div id="stats-dashboard" style="display: none;">
            <div class="stats-card">
                <h5 class="mb-3">üìä T·ªïng quan c√°c tr∆∞·ªùng h·ª£p xu·∫•t to√°n</h5>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="total-records">0</div>
                        <div class="stat-label">T·ªïng b·∫£n ghi</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="total-facilities">0</div>
                        <div class="stat-label">C∆° s·ªü KCB</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="analyzed-records">0</div>
                        <div class="stat-label">ƒê√£ ph√¢n t√≠ch</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="loader" class="loader"></div>
        <div id="results-container"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        let rawDataByCSKCB = {};
        let analysisResults = {};
        const resultsContainer = document.getElementById('results-container');
        const loader = document.getElementById('loader');
        const apiStatus = document.getElementById('api-status');
        let geminiApiKey = '';

        // Load API key from sessionStorage n·∫øu c√≥
        if (typeof(Storage) !== "undefined") {
            geminiApiKey = sessionStorage.getItem('gemini-api-key') || '';
            if (geminiApiKey) {
                document.getElementById('api-key').value = geminiApiKey;
            }
        }

        document.getElementById('api-key').addEventListener('input', function() {
            geminiApiKey = this.value;
            if (typeof(Storage) !== "undefined") {
                sessionStorage.setItem('gemini-api-key', geminiApiKey);
            }
        });

        document.getElementById('test-api').addEventListener('click', async function() {
            const apiKey = document.getElementById('api-key').value.trim();
            if (!apiKey) {
                showApiStatus('Vui l√≤ng nh·∫≠p API key.', 'error');
                return;
            }
            this.disabled = true;
            this.textContent = 'ƒêang ki·ªÉm tra...';
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: "Test connection" }] }] })
                });
                if (response.ok) {
                    showApiStatus('‚úÖ API key h·ª£p l·ªá! S·∫µn s√†ng ph√¢n t√≠ch d·ªØ li·ªáu.', 'success');
                    geminiApiKey = apiKey;
                } else {
                    const error = await response.json();
                    showApiStatus(`‚ùå API key kh√¥ng h·ª£p l·ªá: ${error.error?.message || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                showApiStatus(`‚ùå L·ªói k·∫øt n·ªëi: ${error.message}`, 'error');
            }
            this.disabled = false;
            this.textContent = 'Ki·ªÉm tra API';
        });

        function showApiStatus(message, type) {
            apiStatus.innerHTML = `<div class="api-status ${type}">${message}</div>`;
        }

        document.getElementById('excel-file').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) return;
            resultsContainer.innerHTML = '';
            document.getElementById('stats-dashboard').style.display = 'none';
            loader.style.display = 'block';
            rawDataByCSKCB = {};
            analysisResults = {};
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    let allJsonData = [];
                    workbook.SheetNames.forEach(sheetName => {
                        const jsonData = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName]);
                        allJsonData.push(...jsonData);
                    });
                    processData(allJsonData);
                    renderSummaryTable();
                    updateStatsDashboard();
                } catch (error) {
                    alert("ƒê√£ x·∫£y ra l·ªói khi ƒë·ªçc file. Vui l√≤ng ki·ªÉm tra l·∫°i ƒë·ªãnh d·∫°ng file Excel.\nL·ªói: " + error.message);
                } finally {
                    loader.style.display = 'none';
                }
            };
            reader.onerror = function() {
                 loader.style.display = 'none';
                 alert("Kh√¥ng th·ªÉ ƒë·ªçc ƒë∆∞·ª£c file ƒë√£ ch·ªçn.");
            };
            reader.readAsArrayBuffer(file);
        });

        function processData(allData) {
            allData.forEach(row => {
                const cskcb = row['MA_CSKCB'];
                if (cskcb) {
                    if (!rawDataByCSKCB[cskcb]) rawDataByCSKCB[cskcb] = [];
                    rawDataByCSKCB[cskcb].push(row);
                }
            });
        }

        function updateStatsDashboard() {
            const totalRecords = Object.values(rawDataByCSKCB).reduce((sum, arr) => sum + arr.length, 0);
            const totalFacilities = Object.keys(rawDataByCSKCB).length;
            document.getElementById('total-records').textContent = totalRecords;
            document.getElementById('total-facilities').textContent = totalFacilities;
            document.getElementById('analyzed-records').textContent = '0';
            document.getElementById('stats-dashboard').style.display = 'block';
        }

        function updateAnalysisStats() {
            let analyzed = 0;
            Object.values(analysisResults).forEach(facilityResults => {
                analyzed += Object.keys(facilityResults).length;
            });
            document.getElementById('analyzed-records').textContent = analyzed;
        }

        function renderSummaryTable() {
            const summaryData = Object.keys(rawDataByCSKCB).map(cskcb => ({
                'MA_CSKCB': cskcb,
                'SO_CA': rawDataByCSKCB[cskcb].length
            })).sort((a, b) => a['MA_CSKCB'] > b['MA_CSKCB'] ? 1 : -1);
            if (summaryData.length === 0) {
                resultsContainer.innerHTML = '<p class="text-danger">Kh√¥ng c√≥ d·ªØ li·ªáu h·ª£p l·ªá trong file.</p>';
                return;
            }
            let tableHTML = '<table class="table table-bordered table-hover">';
            tableHTML += `<thead class="table-danger"><tr><th>MA_CSKCB <span class="rejection-badge">XU·∫§T TO√ÅN</span></th><th>S·ªë ca</th><th>Tr·∫°ng th√°i ph√¢n t√≠ch</th></tr></thead><tbody>`;
            summaryData.forEach(row => {
                tableHTML += `<tr class="summary-row" data-cskcb="${row['MA_CSKCB']}"><td>${row['MA_CSKCB']}</td><td>${row['SO_CA']}</td><td id="status-${row['MA_CSKCB']}"><span class="badge bg-secondary">Ch∆∞a ph√¢n t√≠ch</span></td></tr>`;
            });
            tableHTML += '</tbody></table>';
            resultsContainer.innerHTML = tableHTML;
            addSummaryClickListeners();
        }

        function addSummaryClickListeners() {
            document.querySelectorAll('.summary-row').forEach(row => {
                row.addEventListener('click', function() {
                    const cskcb = this.dataset.cskcb;
                    const existingDetailRow = document.querySelector('.detail-container-row');
                    const wasActive = this.classList.contains('table-active');
                    if (existingDetailRow) existingDetailRow.remove();
                    document.querySelectorAll('.summary-row.table-active').forEach(r => r.classList.remove('table-active'));
                    if (!wasActive) {
                        this.classList.add('table-active');
                        const detailRow = document.createElement('tr');
                        detailRow.className = 'detail-container-row';
                        const detailCell = document.createElement('td');
                        detailCell.colSpan = this.cells.length;
                        detailCell.innerHTML = createDetailView(cskcb);
                        detailRow.appendChild(detailCell);
                        this.after(detailRow);
                        addDetailViewListeners(cskcb);
                    }
                });
            });
        }
                
        function createDetailView(cskcb) {
            const rows = rawDataByCSKCB[cskcb];
            const detailColumns = ['TEN_CP', 'MA_BENH', 'MA_BENHKHAC'];
            let html = `
                <div class="detail-header">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0"><span class="header-icon">üö´</span>Chi ti·∫øt c√°c ca xu·∫•t to√°n - CSKCB: ${cskcb}</h5>
                        <div class="d-flex btn-group-custom align-items-center">
                            <button class="btn btn-success btn-sm btn-modern" id="export-excel-all-${cskcb}">üìä Xu·∫•t Excel (T·∫•t c·∫£)</button>
                            <button class="btn btn-warning btn-sm btn-modern" id="export-excel-analyzed-${cskcb}">üìã Xu·∫•t Excel (ƒê√£ ph√¢n t√≠ch)</button>
                            <button class="btn btn-danger btn-sm btn-modern" id="analyze-all-${cskcb}">ü§ñ Ph√¢n t√≠ch t·∫•t c·∫£</button>
                        </div>
                    </div>
                    <div class="filter-section">
                        <input type="text" id="filter-medicine-${cskcb}" class="form-control" placeholder="üîç L·ªçc theo t√™n thu·ªëc/ch·∫ø ph·∫©m...">
                    </div>
                </div>
                <div class="detail-table-wrapper">
                    <table class="table table-sm table-bordered table-striped detail-table">
                        <thead class="table-danger"><tr>
                            ${detailColumns.map(c => `<th>${c}</th>`).join('')}
                            <th>Thao t√°c</th>
                            <th style="min-width: 450px;">L√Ω do xu·∫•t to√°n (Ph√¢n t√≠ch b·ªüi AI)</th>
                        </tr></thead><tbody id="tbody-${cskcb}">`;
            rows.forEach((row, index) => {
                html += '<tr>';
                detailColumns.forEach(col => {
                     let cellContent = row[col] || '';
                    if (col === 'MA_BENH' || col === 'MA_BENHKHAC') {
                        if (cellContent) {
                            cellContent = cellContent.toString().split(';').map(c => c.trim()).filter(Boolean).map(code => `<span class="icd-tag">${code}</span>`).join(' ');
                        }
                    } else if (col === 'TEN_CP') {
                        if (cellContent) cellContent = `<span class="medicine-tag">${cellContent}</span>`;
                    }
                    html += `<td>${cellContent}</td>`;
                });
                html += `
                    <td><button class="btn btn-danger btn-sm ai-analyze-btn btn-modern" data-cskcb="${cskcb}" data-row-index="${index}">üîç Ph√¢n t√≠ch</button></td>
                    <td class="reason-cell not-analyzed" id="reason-${cskcb}-${index}">Ch∆∞a ph√¢n t√≠ch - Click "Ph√¢n t√≠ch" ƒë·ªÉ xem l√Ω do chi ti·∫øt</td>
                </tr>`;
            });
            html += `</tbody></table></div>`;
            return html;
        }

        function addDetailViewListeners(cskcb) {
            document.getElementById(`filter-medicine-${cskcb}`).addEventListener('input', function() {
                filterDetailTable(cskcb, this.value);
            });
            
            // Xu·∫•t Excel t·∫•t c·∫£ (k·ªÉ c·∫£ ch∆∞a ph√¢n t√≠ch)
            document.getElementById(`export-excel-all-${cskcb}`).addEventListener('click', () => exportToExcel(cskcb, 'all'));
            
            // Xu·∫•t Excel ch·ªâ c√°c ca ƒë√£ ph√¢n t√≠ch
            document.getElementById(`export-excel-analyzed-${cskcb}`).addEventListener('click', () => exportToExcel(cskcb, 'analyzed'));
            
            document.getElementById(`analyze-all-${cskcb}`).addEventListener('click', function() {
                if (!geminiApiKey) {
                    alert('Vui l√≤ng c·∫•u h√¨nh API key tr∆∞·ªõc khi s·ª≠ d·ª•ng.');
                    return;
                }
                const buttons = document.querySelectorAll(`#tbody-${cskcb} .ai-analyze-btn:not(:disabled)`);
                buttons.forEach((btn, index) => {
                    setTimeout(() => btn.click(), index * 1500); // TƒÉng delay ƒë·ªÉ tr√°nh rate limit
                });
            });
            
            document.querySelectorAll(`#tbody-${cskcb} .ai-analyze-btn`).forEach(btn => {
                btn.addEventListener('click', async function() {
                    if (!geminiApiKey) {
                        alert('Vui l√≤ng c·∫•u h√¨nh API key tr∆∞·ªõc khi s·ª≠ d·ª•ng.');
                        return;
                    }
                    const rowIndex = this.dataset.rowIndex;
                    const cskcb = this.dataset.cskcb;
                    const rowData = rawDataByCSKCB[cskcb][rowIndex];
                    const reasonCell = document.getElementById(`reason-${cskcb}-${rowIndex}`);
                    this.disabled = true;
                    this.innerHTML = '‚è≥ ƒêang x·ª≠ l√Ω...';
                    reasonCell.innerHTML = 'ü§ñ ƒêang ph√¢n t√≠ch v·ªõi AI... Vui l√≤ng ch·ªù';
                    reasonCell.className = 'reason-cell analyzing';
                    try {
                        const analysis = await analyzeWithGemini(rowData);
                        if (!analysisResults[cskcb]) analysisResults[cskcb] = {};
                        analysisResults[cskcb][rowIndex] = analysis;
                        
                        // Format k·∫øt qu·∫£ ƒë·∫πp h∆°n
                        reasonCell.innerHTML = `
                            <div class="reason-header">‚ùå L√ù DO XU·∫§T TO√ÅN</div>
                            <div class="reason-content">
                                <strong>L√Ω do ch√≠nh:</strong> ${analysis.summary}
                                ${analysis.details && analysis.details.length > 0 ?
                                     `<div class="analysis-summary"><strong>Chi ti·∫øt:</strong> ${analysis.details.join('; ')}</div>`
                                     : ''}
                            </div>
                        `;
                        reasonCell.className = 'reason-cell rejected';
                        this.innerHTML = '‚úÖ ƒê√£ ph√¢n t√≠ch';
                        updateAnalysisStats();
                        updateFacilityStatus(cskcb);
                    } catch (error) {
                        reasonCell.innerHTML = `
                            <div class="reason-header">‚ö†Ô∏è L·ªñI PH√ÇN T√çCH</div>
                            <div class="reason-content">
                                <strong>L·ªói:</strong> ${error.message}
                                <br><small>Vui l√≤ng th·ª≠ l·∫°i sau.</small>
                            </div>
                        `;
                        reasonCell.className = 'reason-cell rejected';
                        this.disabled = false;
                        this.innerHTML = 'üîÑ Ph√¢n t√≠ch l·∫°i';
                    }
                });
            });
        }

        function filterDetailTable(cskcb, medicineTerm) {
            const term = medicineTerm.toLowerCase();
            const rows = document.getElementById(`tbody-${cskcb}`).getElementsByTagName('tr');
            for (const row of rows) {
                const medicineCell = row.getElementsByTagName('td')[0];
                if (medicineCell && medicineCell.textContent.toLowerCase().includes(term)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            }
        }
                
        function exportToExcel(cskcb, type) {
            const allRows = rawDataByCSKCB[cskcb];
            if (!allRows || allRows.length === 0) {
                alert('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t cho CSKCB n√†y.');
                return;
            }
            
            let dataToExport = [];
            if (type === 'all') {
                // Xu·∫•t t·∫•t c·∫£ c√°c ca
                dataToExport = allRows.map((row, index) => {
                    const analysis = analysisResults[cskcb]?.[index];
                    return {
                        'STT': index + 1,
                        'MA_CSKCB': cskcb,
                        'TEN_CHE_PHAM': row['TEN_CP'] || '',
                        'MA_BENH_CHINH': row['MA_BENH'] || '',
                        'MA_BENH_KEM_THEO': row['MA_BENHKHAC'] || '',
                        'TRANG_THAI_PHAN_TICH': analysis ? 'ƒê√£ ph√¢n t√≠ch' : 'Ch∆∞a ph√¢n t√≠ch',
                        'LY_DO_XUAT_TOAN_CHINH': analysis ? analysis.summary : 'Ch∆∞a ph√¢n t√≠ch',
                        'CHI_TIET_PHAN_TICH': analysis && analysis.details ? analysis.details.join('; ') : '',
                        'NGAY_PHAN_TICH': analysis ? new Date().toLocaleDateString('vi-VN') : ''
                    };
                });
            } else {
                // Xu·∫•t ch·ªâ c√°c ca ƒë√£ ph√¢n t√≠ch
                dataToExport = allRows.map((row, index) => {
                    const analysis = analysisResults[cskcb]?.[index];
                    if (analysis) {
                        return {
                            'STT': index + 1,
                            'MA_CSKCB': cskcb,
                            'TEN_CHE_PHAM': row['TEN_CP'] || '',
                            'MA_BENH_CHINH': row['MA_BENH'] || '',
                            'MA_BENH_KEM_THEO': row['MA_BENHKHAC'] || '',
                            'TRANG_THAI_PHAN_TICH': 'ƒê√£ ph√¢n t√≠ch',
                            'LY_DO_XUAT_TOAN_CHINH': analysis.summary,
                            'CHI_TIET_PHAN_TICH': analysis.details ? analysis.details.join('; ') : '',
                            'NGAY_PHAN_TICH': new Date().toLocaleDateString('vi-VN')
                        };
                    }
                    return null;
                }).filter(Boolean); // L·ªçc b·ªè c√°c gi√° tr·ªã null
            }

            if (dataToExport.length === 0) {
                alert(type === 'all' ? 'Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t.' : 'Kh√¥ng c√≥ ca n√†o ƒë√£ ƒë∆∞·ª£c ph√¢n t√≠ch ƒë·ªÉ xu·∫•t.');
                return;
            }

            const filename = `KetQuaXuatToan_${cskcb}_${type}_${new Date().toISOString().slice(0, 10)}`;
            downloadAsExcel(dataToExport, filename);
        }

        function downloadAsExcel(data, filename) {
            const worksheet = XLSX.utils.json_to_sheet(data);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'KetQuaPhanTich');
            
            // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh ƒë·ªô r·ªông c·ªôt
            const cols = Object.keys(data[0]);
            const colWidths = cols.map(col => ({ 
                wch: Math.max(...data.map(row => row[col] ? row[col].toString().length : 10), col.length) + 2 
            }));
            worksheet['!cols'] = colWidths;

            XLSX.writeFile(workbook, filename + '.xlsx');
        }

        async function analyzeWithGemini(rowData) {
            if (!geminiApiKey) throw new Error('API key ch∆∞a ƒë∆∞·ª£c c·∫•u h√¨nh');
            
            const prompt = `
            B·∫°n l√† chuy√™n gia gi√°m ƒë·ªãnh BHYT Vi·ªát Nam. Gi·∫£ ƒë·ªãnh r·∫±ng vi·ªác BHYT t·ª´ ch·ªëi thanh to√°n (xu·∫•t to√°n) l√† ƒê√öNG.

            L∆ØU √ù: Ch·∫ø ph·∫©m n√†y LU√îN THU·ªòC DANH M·ª§C BHYT. L√Ω do t·ª´ ch·ªëi kh√¥ng th·ªÉ l√† "thu·ªëc ngo√†i danh m·ª•c".

            TH√îNG TIN:
            - Ch·∫ø ph·∫©m: ${rowData['TEN_CP'] || 'Kh√¥ng c√≥'}
            - M√£ b·ªánh ch√≠nh (ICD-10): ${rowData['MA_BENH'] || 'Kh√¥ng c√≥'}
            - M√£ b·ªánh k√®m theo (ICD-10): ${rowData['MA_BENHKHAC'] || 'Kh√¥ng c√≥'}

            Y√äU C·∫¶U:
            1.  **summary (T√≥m t·∫Øt)**: ƒê∆∞a ra l√Ω do ch√≠nh t·ª´ ch·ªëi thanh to√°n m·ªôt c√°ch s√∫c t√≠ch.
            2.  **details (Chi ti·∫øt)**: ƒê·ªÉ l√†m r√µ, h√£y gi·∫£i th√≠ch t·∫°i sao ch·∫©n ƒëo√°n hi·ªán t·∫°i kh√¥ng ph√π h·ª£p V√Ä li·ªát k√™ m·ªôt v√†i b·ªánh l√Ω kh√°c (k√®m m√£ ICD-10) m√† ch·∫ø ph·∫©m n√†y ch·ªëng ch·ªâ ƒë·ªãnh, t∆∞∆°ng t√°c thu·ªëc. T√™n thu·ªëc	Ho·∫°t ch·∫•t	Lo·∫°i c·∫£nh b√°o	ƒêi·ªÅu ki·ªán	M√£ ICD	T√™n ICD	Ghi ch√∫
Meloxicam	Meloxicam	Ch·ªëng ch·ªâ ƒë·ªãnh	Lo√©t d·∫° d√†y t√° tr√†ng	K25	Lo√©t d·∫° d√†y	TƒÉng nguy c∆° xu·∫•t huy·∫øt ti√™u h√≥a ‚Äì ƒë·∫∑c bi·ªát ·ªü ng∆∞·ªùi c√≥ ti·ªÅn s·ª≠
Meloxicam	Meloxicam	Th·∫≠n tr·ªçng	TƒÉng huy·∫øt √°p	I10	TƒÉng huy·∫øt √°p	C√≥ th·ªÉ g√¢y gi·ªØ mu·ªëi n∆∞·ªõc ‚Äì tƒÉng huy·∫øt √°p
Meloxicam	Meloxicam	Th·∫≠n tr·ªçng	Hen ph·∫ø qu·∫£n	J45	Hen ph·∫ø qu·∫£n	C√≥ th·ªÉ g√¢y co th·∫Øt ph·∫ø qu·∫£n ·ªü ng∆∞·ªùi m·∫´n c·∫£m aspirin
Ketoprofen	Ketoprofen	Ch·ªëng ch·ªâ ƒë·ªãnh	Lo√©t d·∫° d√†y t√° tr√†ng	K25	Lo√©t d·∫° d√†y	TƒÉng nguy c∆° lo√©t v√† xu·∫•t huy·∫øt ti√™u h√≥a
Ketoprofen	Ketoprofen	Th·∫≠n tr·ªçng	Suy th·∫≠n	N18	Suy th·∫≠n m·∫°n	Hi·ªáu ch·ªânh li·ªÅu ‚Äì tr√°nh d√πng k√©o d√†i
Tenoxicam	Tenoxicam	Ch·ªëng ch·ªâ ƒë·ªãnh	Lo√©t d·∫° d√†y t√° tr√†ng	K25	Lo√©t d·∫° d√†y	Ch·ªëng ch·ªâ ƒë·ªãnh tuy·ªát ƒë·ªëi ‚Äì tƒÉng nguy c∆° bi·∫øn ch·ª©ng xu·∫•t huy·∫øt
Paracetamol	Paracetamol	Ch·ªëng ch·ªâ ƒë·ªãnh	Suy gan n·∫∑ng	K72	Suy gan	Nguy c∆° ƒë·ªôc gan nghi√™m tr·ªçng ‚Äì tr√°nh d√πng
Paracetamol	Paracetamol	Th·∫≠n tr·ªçng	Thi·∫øu men G6PD	D55	Thi·∫øu G6PD	C√≥ th·ªÉ g√¢y t√°n huy·∫øt n·∫øu d√πng li·ªÅu cao
Dexamethason	Dexamethason	Th·∫≠n tr·ªçng	Lo√©t d·∫° d√†y t√° tr√†ng	K25	Lo√©t d·∫° d√†y	Corticoid l√†m tƒÉng ti·∫øt acid v√† gi·∫£m b·∫£o v·ªá ni√™m m·∫°c d·∫° d√†y
Dexamethason	Dexamethason	Th·∫≠n tr·ªçng	TƒÉng huy·∫øt √°p	I10	TƒÉng huy·∫øt √°p	C√≥ th·ªÉ l√†m tƒÉng huy·∫øt √°p n·∫øu d√πng k√©o d√†i
Losartan	Losartan	Th·∫≠n tr·ªçng	Suy th·∫≠n	N18	Suy th·∫≠n m·∫°n	C·∫ßn hi·ªáu ch·ªânh li·ªÅu, theo d√µi creatinin huy·∫øt thanh
Losartan	Losartan	Ch·ªëng ch·ªâ ƒë·ªãnh	Ph·ª• n·ªØ c√≥ thai 3 th√°ng gi·ªØa v√† cu·ªëi	O36.4	Thai k·ª≥ nguy c∆°	·∫¢nh h∆∞·ªüng ƒë·∫øn thai ‚Äì g√¢y qu√°i thai, gi·∫£m s·∫£n th·∫≠n
Amlodipin	Amlodipin	Th·∫≠n tr·ªçng	H·∫° huy·∫øt √°p	I95	H·∫° huy·∫øt √°p	C√≥ th·ªÉ g√¢y t·ª•t huy·∫øt √°p qu√° m·ª©c ·ªü li·ªÅu cao
Amlodipin	Amlodipin	Th·∫≠n tr·ªçng	Suy gan	K72	Suy gan	Gi·∫£m chuy·ªÉn h√≥a ‚Äì c·∫ßn gi·∫£m li·ªÅu
Spironolacton	Spironolacton	Ch·ªëng ch·ªâ ƒë·ªãnh	TƒÉng kali m√°u	E87.5	R·ªëi lo·∫°n ƒëi·ªán gi·∫£i	C√≥ th·ªÉ g√¢y lo·∫°n nh·ªãp, ng·ª´ng tim n·∫øu K+ > 5.5 mmol/L
Spironolacton	Spironolacton	Th·∫≠n tr·ªçng	Suy gan	K72	Suy gan	C·∫ßn theo d√µi s√°t ƒëi·ªán gi·∫£i v√† ch·ª©c nƒÉng gan
Bisoprolol	Bisoprolol	Ch·ªëng ch·ªâ ƒë·ªãnh	Hen ph·∫ø qu·∫£n	J45	Hen ph·∫ø qu·∫£n	·ª®c ch·∫ø beta g√¢y co th·∫Øt ph·∫ø qu·∫£n
Bisoprolol	Bisoprolol	Ch·ªëng ch·ªâ ƒë·ªãnh	Block nhƒ© th·∫•t ƒë·ªô II‚ÄìIII	I44.1	Block nhƒ© th·∫•t	G√¢y ch·∫≠m nh·ªãp tim n·∫∑ng h∆°n
Digoxin	Digoxin	Th·∫≠n tr·ªçng	Suy th·∫≠n	N18	Suy th·∫≠n m·∫°n	Th·∫£i tr·ª´ qua th·∫≠n ‚Äì nguy c∆° ng·ªô ƒë·ªôc n·∫øu kh√¥ng ch·ªânh li·ªÅu
Digoxin	Digoxin	Ch·ªëng ch·ªâ ƒë·ªãnh	Block AV ho√†n to√†n	I44.2	Block nhƒ© th·∫•t ho√†n to√†n	G√¢y nguy c∆° ng·ª´ng tim
Metformin	Metformin	Ch·ªëng ch·ªâ ƒë·ªãnh	Suy th·∫≠n n·∫∑ng (eGFR <30)	N18.5	B·ªánh th·∫≠n m·∫°n G5	Nguy c∆° nhi·ªÖm toan lactic ‚Äì kh√¥ng d√πng
Metformin	Metformin	Ch·ªëng ch·ªâ ƒë·ªãnh	Suy gan	K72	Suy gan	TƒÉng nguy c∆° nhi·ªÖm toan lactic
Metformin	Metformin	Th·∫≠n tr·ªçng	Ng∆∞·ªùi cao tu·ªïi	Z72.3	Ng∆∞·ªùi cao tu·ªïi	C·∫ßn ƒë√°nh gi√° ch·ª©c nƒÉng th·∫≠n ƒë·ªãnh k·ª≥
Glimepiride	Glimepiride	Ch·ªëng ch·ªâ ƒë·ªãnh	ƒê√°i th√°o ƒë∆∞·ªùng type 1	E10	ƒêTƒê type 1	Kh√¥ng hi·ªáu qu·∫£ ‚Äì nguy c∆° h·∫° ƒë∆∞·ªùng huy·∫øt nghi√™m tr·ªçng
Glimepiride	Glimepiride	Th·∫≠n tr·ªçng	Ng∆∞·ªùi cao tu·ªïi	Z72.3	Ng∆∞·ªùi cao tu·ªïi	D·ªÖ h·∫° ƒë∆∞·ªùng huy·∫øt k√©o d√†i ‚Äì c·∫ßn theo d√µi
Gliclazide	Gliclazide	Ch·ªëng ch·ªâ ƒë·ªãnh	Suy gan n·∫∑ng	K72	Suy gan	Nguy c∆° t√≠ch l≈©y thu·ªëc ‚Äì tƒÉng h·∫° ƒë∆∞·ªùng huy·∫øt
Gliclazide	Gliclazide	Th·∫≠n tr·ªçng	Suy th·∫≠n	N18	Suy th·∫≠n m·∫°n	Ch·ªânh li·ªÅu ‚Äì tr√°nh t√≠ch l≈©y g√¢y h·∫° ƒë∆∞·ªùng huy·∫øt
Sitagliptin	Sitagliptin	Th·∫≠n tr·ªçng	Suy th·∫≠n	N18	Suy th·∫≠n m·∫°n	C·∫ßn hi·ªáu ch·ªânh li·ªÅu theo m·ª©c eGFR
Sitagliptin	Sitagliptin	Th·∫≠n tr·ªçng	Vi√™m t·ª•y c·∫•p	K85	Vi√™m t·ª•y c·∫•p	Ng·ª´ng thu·ªëc n·∫øu c√≥ bi·ªÉu hi·ªán vi√™m t·ª•y
Sitagliptin	Sitagliptin	Ch·ªëng ch·ªâ ƒë·ªãnh	Qu√° m·∫´n v·ªõi Sitagliptin	T78	Ph·∫£n ·ª©ng d·ªã ·ª©ng	Ph·∫£n v·ªá ‚Äì m√†y ƒëay, ph√π m·∫°ch ƒë√£ ghi nh·∫≠n
Amoxicillin	Amoxicillin	Ch·ªëng ch·ªâ ƒë·ªãnh	D·ªã ·ª©ng penicillin	T88.7	Ph·∫£n ·ª©ng d·ªã ·ª©ng v·ªõi thu·ªëc	Nguy c∆° s·ªëc ph·∫£n v·ªá, n·ªïi m·ªÅ ƒëay, ph√π m·∫°ch
Amoxicillin + Clavulanat	Amoxicillin + Clavulanic acid	Th·∫≠n tr·ªçng	B·ªánh gan	K76	B·ªánh gan kh√°c	C√≥ th·ªÉ g√¢y vi√™m gan ·ª© m·∫≠t ‚Äì theo d√µi men gan
Cefuroxim	Cefuroxim	Th·∫≠n tr·ªçng	Suy th·∫≠n	N18	Suy th·∫≠n m·∫°n	C·∫ßn hi·ªáu ch·ªânh li·ªÅu ‚Äì th·∫£i qua th·∫≠n
Ciprofloxacin	Ciprofloxacin	Ch·ªëng ch·ªâ ƒë·ªãnh	Tr·∫ª em < 18 tu·ªïi	Z00.12	Kh√°m s·ª©c kh·ªèe tr·∫ª em	·∫¢nh h∆∞·ªüng ph√°t tri·ªÉn s·ª•n kh·ªõp
Ciprofloxacin	Ciprofloxacin	Th·∫≠n tr·ªçng	Ng∆∞·ªùi cao tu·ªïi	Z72.3	Ng∆∞·ªùi cao tu·ªïi	TƒÉng nguy c∆° g√¢n b·ªã vi√™m ho·∫∑c ƒë·ª©t g√¢n
Erythromycin	Erythromycin	Ch·ªëng ch·ªâ ƒë·ªãnh	K√©o d√†i QT	I45.81	H·ªôi ch·ª©ng QT k√©o d√†i	TƒÉng nguy c∆° lo·∫°n nh·ªãp nghi√™m tr·ªçng
Erythromycin	Erythromycin	Th·∫≠n tr·ªçng	Suy gan	K72	Suy gan	C·∫ßn hi·ªáu ch·ªânh li·ªÅu, nguy c∆° t√≠ch l≈©y
Metronidazol	Metronidazol	Ch·ªëng ch·ªâ ƒë·ªãnh	D·ªã ·ª©ng metronidazol	T88.7	Ph·∫£n ·ª©ng d·ªã ·ª©ng v·ªõi thu·ªëc	Ph·∫£n v·ªá, n·ªïi m·ªÅ ƒëay, nguy c∆° s·ªëc
Metronidazol	Metronidazol	Th·∫≠n tr·ªçng	B·ªánh l√Ω th·∫ßn kinh ngo·∫°i bi√™n	G62	B·ªánh th·∫ßn kinh ngo·∫°i bi√™n	C√≥ th·ªÉ l√†m n·∫∑ng th√™m tri·ªáu ch·ª©ng
Metronidazol	Metronidazol	Th·∫≠n tr·ªçng	Suy gan	K72	Suy gan	C·∫ßn gi·∫£m li·ªÅu n·∫øu suy gan trung b√¨nh/n·∫∑ng
Berberin	Berberin	Th·∫≠n tr·ªçng	Thi·∫øu men G6PD	D55	Thi·∫øu G6PD	C√≥ th·ªÉ g√¢y t√°n huy·∫øt ·ªü ng∆∞·ªùi thi·∫øu G6PD
Berberin	Berberin	Th·∫≠n tr·ªçng	Ph·ª• n·ªØ c√≥ thai	O26.8	Bi·∫øn ch·ª©ng thai k·ª≥	K√≠ch th√≠ch t·ª≠ cung ‚Äì c√≥ nguy c∆° co b√≥p t·ª≠ cung s·ªõm
Actis√¥	Cynara scolymus	Th·∫≠n tr·ªçng	T·∫Øc ·ªëng m·∫≠t	K83.1	T·∫Øc ·ªëng m·∫≠t	TƒÉng ti·∫øt m·∫≠t ‚Äì kh√¥ng d√πng n·∫øu ƒë√£ t·∫Øc
Rau ƒë·∫Øng ƒë·∫•t	Glinus oppositifolius	Th·∫≠n tr·ªçng	Huy·∫øt √°p th·∫•p	I95	H·∫° huy·∫øt √°p	C√≥ th·ªÉ l√†m t·ª•t huy·∫øt √°p th√™m ‚Äì theo d√µi s√°t
Ho√†ng b√°	Phellodendron amurense	Ch·ªëng ch·ªâ ƒë·ªãnh	Ng∆∞·ªùi ƒëang d√πng kh√°ng sinh quinolon	Z92.2	Ti·ªÅn s·ª≠ d√πng kh√°ng sinh	Hi·ªáp ƒë·ªìng tƒÉng ƒë·ªôc t√≠nh th·∫ßn kinh trung ∆∞∆°ng
H∆∞∆°ng ph·ª•	Cyperus rotundus	Th·∫≠n tr·ªçng	R·ªëi lo·∫°n kinh nguy·ªát	N92	R·ªëi lo·∫°n kinh nguy·ªát	C·∫ßn th·∫≠n tr·ªçng v√¨ ·∫£nh h∆∞·ªüng n·ªôi ti·∫øt
Qu·∫ø chi	Cinnamomum cassia	Th·∫≠n tr·ªçng	TƒÉng huy·∫øt √°p	I10	TƒÉng huy·∫øt √°p	C√≥ th·ªÉ l√†m tƒÉng huy·∫øt √°p nh·∫π ‚Äì c·∫ßn theo d√µi
Ng∆∞u t·∫•t	Achyranthes bidentata	Ch·ªëng ch·ªâ ƒë·ªãnh	Ph·ª• n·ªØ c√≥ thai	O26.8	Bi·∫øn ch·ª©ng thai k·ª≥	K√≠ch th√≠ch t·ª≠ cung ‚Äì c√≥ th·ªÉ g√¢y s·∫©y thai
H√† th·ªß √¥ ƒë·ªè	Fallopia multiflora	Ch·ªëng ch·ªâ ƒë·ªãnh	Suy gan	K72	Suy gan	ƒê√£ ghi nh·∫≠n nhi·ªÅu ca ƒë·ªôc gan do ch·∫ø ph·∫©m
C√°t cƒÉn	Pueraria thomsonii	Th·∫≠n tr·ªçng	Ti√™u ch·∫£y	K59.1	Ti√™u ch·∫£y ch·ª©c nƒÉng	TƒÉng ti·∫øt ‚Äì c√≥ th·ªÉ l√†m n·∫∑ng tri·ªáu ch·ª©ng
Levocetirizine	Levocetirizine dihydrochloride	Th·∫≠n tr·ªçng	Suy th·∫≠n	N18	Suy th·∫≠n m·∫°n	C·∫ßn hi·ªáu ch·ªânh li·ªÅu theo eGFR
Fexofenadine	Fexofenadine hydrochloride	Th·∫≠n tr·ªçng	Suy th·∫≠n	N18	Suy th·∫≠n m·∫°n	Th·∫£i qua th·∫≠n ‚Äì gi·∫£m li·ªÅu n·∫øu eGFR < 50
Loperamide	Loperamide hydrochloride	Ch·ªëng ch·ªâ ƒë·ªãnh	Vi√™m ƒë·∫°i tr√†ng n·∫∑ng	K51	Vi√™m lo√©t ƒë·∫°i tr√†ng	TƒÉng nguy c∆° ph√¨nh ƒë·∫°i tr√†ng nhi·ªÖm ƒë·ªôc
Loperamide	Loperamide hydrochloride	Ch·ªëng ch·ªâ ƒë·ªãnh	Tr·∫ª < 2 tu·ªïi	Z00.12	Kh√°m s·ª©c kh·ªèe tr·∫ª em	Nguy c∆° ·ª©c ch·∫ø th·∫ßn kinh trung ∆∞∆°ng ‚Äì kh√¥ng d√πng
Alverin	Alverine citrate	Th·∫≠n tr·ªçng	Suy gan	K72	Suy gan	Ch∆∞a c√≥ d·ªØ li·ªáu an to√†n ‚Äì th·∫≠n tr·ªçng khi d√πng
Alverin	Alverine citrate	Th·∫≠n tr·ªçng	Suy th·∫≠n	N18	Suy th·∫≠n m·∫°n	C·∫ßn c√¢n nh·∫Øc li·ªÅu ·ªü ng∆∞·ªùi suy th·∫≠n n·∫∑ng
Bromhexin	Bromhexine hydrochloride	Th·∫≠n tr·ªçng	Lo√©t d·∫° d√†y	K25	Lo√©t d·∫° d√†y	K√≠ch th√≠ch ni√™m m·∫°c ‚Äì d√πng th·∫≠n tr·ªçng
Bromhexin	Bromhexine hydrochloride	Th·∫≠n tr·ªçng	Hen ph·∫ø qu·∫£n	J45	Hen ph·∫ø qu·∫£n	C√≥ th·ªÉ k√≠ch th√≠ch ho co th·∫Øt ‚Äì theo d√µi
Ambroxol	Ambroxol hydrochloride	Th·∫≠n tr·ªçng	Lo√©t d·∫° d√†y	K25	Lo√©t d·∫° d√†y	C√≥ th·ªÉ g√¢y k√≠ch ·ª©ng d·∫° d√†y
Ambroxol	Ambroxol hydrochloride	Th·∫≠n tr·ªçng	Suy gan	K72	Suy gan	Chuy·ªÉn h√≥a qua gan ‚Äì n√™n th·∫≠n tr·ªçng n·∫øu suy gan n·∫∑ng
Clorpheniramin	Chlorpheniramine maleate	Ch·ªëng ch·ªâ ƒë·ªãnh	Glaucoma g√≥c ƒë√≥ng	H40	Glaucoma g√≥c ƒë√≥ng	TƒÉng nh√£n √°p ‚Äì c√≥ th·ªÉ l√†m n·∫∑ng b·ªánh
Clorpheniramin	Chlorpheniramine maleate	Ch·ªëng ch·ªâ ƒë·ªãnh	Ph√¨ ƒë·∫°i tuy·∫øn ti·ªÅn li·ªát	N40	Ph√¨ ƒë·∫°i tuy·∫øn ti·ªÅn li·ªát	Nguy c∆° b√≠ ti·ªÉu ‚Äì ch·ªëng ch·ªâ ƒë·ªãnh
Salbutamol	Salbutamol sulfate	Th·∫≠n tr·ªçng	B·ªánh tim thi·∫øu m√°u c·ª•c b·ªô	I25	B·ªánh m·∫°ch v√†nh m√£n	C√≥ th·ªÉ g√¢y lo·∫°n nh·ªãp, ƒëau ng·ª±c ‚Äì c·∫ßn theo d√µi
Salbutamol	Salbutamol sulfate	Th·∫≠n tr·ªçng	ƒê√°i th√°o ƒë∆∞·ªùng	E14	ƒê√°i th√°o ƒë∆∞·ªùng	TƒÉng glucose huy·∫øt ‚Äì c·∫ßn ki·ªÉm so√°t ƒë∆∞·ªùng m√°u
Acetylcystein	Acetylcysteine	Th·∫≠n tr·ªçng	Lo√©t d·∫° d√†y	K25	Lo√©t d·∫° d√†y	K√≠ch ·ª©ng ni√™m m·∫°c ‚Äì c·∫ßn th·∫≠n tr·ªçng
Acetylcystein	Acetylcysteine	Th·∫≠n tr·ªçng	Hen ph·∫ø qu·∫£n	J45	Hen ph·∫ø qu·∫£n	C√≥ th·ªÉ g√¢y co th·∫Øt ph·∫ø qu·∫£n ·ªü m·ªôt s·ªë b·ªánh nh√¢n
Prednisolon	Prednisolone	Th·∫≠n tr·ªçng	TƒÉng huy·∫øt √°p	I10	TƒÉng huy·∫øt √°p	C√≥ th·ªÉ gi·ªØ n∆∞·ªõc, tƒÉng huy·∫øt √°p khi d√πng k√©o d√†i
Prednisolon	Prednisolone	Th·∫≠n tr·ªçng	Lo√©t d·∫° d√†y	K25	Lo√©t d·∫° d√†y	Corticoid l√†m tƒÉng nguy c∆° xu·∫•t huy·∫øt ti√™u h√≥a
Magnesi B6	Magnesium lactate + Pyridoxine	Th·∫≠n tr·ªçng	Suy th·∫≠n	N18	Suy th·∫≠n m·∫°n	Nguy c∆° tƒÉng Mg m√°u n·∫øu ch·ª©c nƒÉng th·∫≠n suy
Cimetidin	Cimetidine	Th·∫≠n tr·ªçng	Suy gan	K72	Suy gan	Chuy·ªÉn h√≥a t·∫°i gan ‚Äì c·∫ßn gi·∫£m li·ªÅu n·∫øu n·∫∑ng
Alpha chymotrypsin	Alpha chymotrypsin	Ch·ªëng ch·ªâ ƒë·ªãnh	D·ªã ·ª©ng v·ªõi protein	T78	Ph·∫£n ·ª©ng d·ªã ·ª©ng	C√≥ th·ªÉ g√¢y ph·∫£n v·ªá ‚Äì ƒë·∫∑c bi·ªát ·ªü ng∆∞·ªùi d·ªã ·ª©ng ch·∫ø ph·∫©m enzyme
Alpha chymotrypsin	Alpha chymotrypsin	Th·∫≠n tr·ªçng	R·ªëi lo·∫°n ƒë√¥ng m√°u	D68	R·ªëi lo·∫°n ƒë√¥ng m√°u	TƒÉng nguy c∆° ch·∫£y m√°u ‚Äì kh√¥ng d√πng tr∆∞·ªõc ph·∫´u thu·∫≠t
Bacillus clausii	Bacillus clausii spores	Th·∫≠n tr·ªçng	Suy gi·∫£m mi·ªÖn d·ªãch	D84	Suy gi·∫£m mi·ªÖn d·ªãch	Th·∫≠n tr·ªçng v√¨ l√† ch·∫ø ph·∫©m vi sinh s·ªëng
Sorbitol	Sorbitol	Ch·ªëng ch·ªâ ƒë·ªãnh	T·∫Øc ru·ªôt	K56	T·∫Øc ru·ªôt	TƒÉng nguy c∆° ƒë·∫ßy h∆°i, ch∆∞·ªõng b·ª•ng ‚Äì ch·ªëng ch·ªâ ƒë·ªãnh khi t·∫Øc ngh·∫Ωn c∆° h·ªçc
Alimemazin	Alimemazine tartrate	Ch·ªëng ch·ªâ ƒë·ªãnh	Tr·∫ª < 2 tu·ªïi	Z00.12	Kh√°m s·ª©c kh·ªèe tr·∫ª em	Nguy c∆° ·ª©c ch·∫ø h√¥ h·∫•p ·ªü tr·∫ª nh·ªè
Alimemazin	Alimemazine tartrate	Th·∫≠n tr·ªçng	B·ªánh Parkinson	G20	Parkinson	Kh√°ng cholinergic ‚Äì c√≥ th·ªÉ l√†m n·∫∑ng run c·ª©ng
Acid folic	Folic acid	Th·∫≠n tr·ªçng	Thi·∫øu m√°u kh√¥ng do thi·∫øu folat	D64.9	Thi·∫øu m√°u kh√¥ng x√°c ƒë·ªãnh	C√≥ th·ªÉ che l·∫•p thi·∫øu m√°u √°c t√≠nh ‚Äì l√†m ch·∫≠m ch·∫©n ƒëo√°n
Clotrimazole	Clotrimazole	Th·∫≠n tr·ªçng	Vi√™m da ti·∫øp x√∫c	L23	Vi√™m da ti·∫øp x√∫c	D·ªÖ g√¢y k√≠ch ·ª©ng n·∫øu d√πng b√¥i nhi·ªÅu l·∫ßn/ng√†y
Betamethasone	Betamethasone	Th·∫≠n tr·ªçng	Nhi·ªÖm khu·∫©n ch∆∞a ƒëi·ªÅu tr·ªã	B99	Nhi·ªÖm tr√πng kh√¥ng ƒë·∫∑c hi·ªáu	Corticoid l√†m che d·∫•u tri·ªáu ch·ª©ng, lan r·ªông nhi·ªÖm khu·∫©n
Betamethasone	Betamethasone	Th·∫≠n tr·ªçng	ƒê√°i th√°o ƒë∆∞·ªùng	E14	ƒê√°i th√°o ƒë∆∞·ªùng	C√≥ th·ªÉ g√¢y tƒÉng ƒë∆∞·ªùng huy·∫øt ‚Äì c·∫ßn theo d√µi ch·∫∑t
Ranitidin	Ranitidine	Ch·ªëng ch·ªâ ƒë·ªãnh	Qu√° m·∫´n v·ªõi Ranitidine	T78	Ph·∫£n ·ª©ng d·ªã ·ª©ng	Ghi nh·∫≠n ph·∫£n v·ªá v√† m√†y ƒëay ‚Äì ch·ªëng ch·ªâ ƒë·ªãnh
Ranitidin	Ranitidine	Th·∫≠n tr·ªçng	Suy th·∫≠n	N18	Suy th·∫≠n m·∫°n	Th·∫£i qua th·∫≠n ‚Äì c·∫ßn gi·∫£m li·ªÅu
Lansoprazole	Lansoprazole	Th·∫≠n tr·ªçng	Suy gan	K72	Suy gan	Chuy·ªÉn h√≥a qua gan ‚Äì gi·∫£m li·ªÅu n·∫øu n·∫∑ng
Aluminum hydroxide	Aluminum hydroxide	Th·∫≠n tr·ªçng	Suy th·∫≠n	N18	Suy th·∫≠n m·∫°n	TƒÉng nguy c∆° t√≠ch l≈©y nh√¥m ‚Äì g√¢y ƒë·ªôc th·∫ßn kinh
Simethicone	Simethicone	Th·∫≠n tr·ªçng	T·∫Øc ru·ªôt	K56	T·∫Øc ru·ªôt	Kh√¥ng hi·ªáu qu·∫£ khi c√≥ t·∫Øc c∆° h·ªçc ‚Äì th·∫≠n tr·ªçng
Bismuth subcitrate	Bismuth subcitrate	Th·∫≠n tr·ªçng	Suy th·∫≠n	N18	Suy th·∫≠n m·∫°n	TƒÉng t√≠ch l≈©y ‚Äì nguy c∆° ƒë·ªôc th·∫ßn kinh
Misoprostol	Misoprostol	Ch·ªëng ch·ªâ ƒë·ªãnh	Ph·ª• n·ªØ c√≥ thai	O26.8	Bi·∫øn ch·ª©ng thai k·ª≥	C√≥ th·ªÉ g√¢y co b√≥p t·ª≠ cung ‚Äì s·∫©y thai
Misoprostol	Misoprostol	Th·∫≠n tr·ªçng	Ti√™u ch·∫£y	K59.1	Ti√™u ch·∫£y ch·ª©c nƒÉng	T√°c d·ª•ng ph·ª• th∆∞·ªùng g·∫∑p ‚Äì c√≥ th·ªÉ l√†m n·∫∑ng th√™m
Hydrotalcite	Hydrotalcite	Th·∫≠n tr·ªçng	Suy th·∫≠n	N18	Suy th·∫≠n m·∫°n	TƒÉng nguy c∆° t√≠ch l≈©y Mg, Al ‚Äì d√πng th·∫≠n tr·ªçng
Domperidone	Domperidone	Ch·ªëng ch·ªâ ƒë·ªãnh	Lo·∫°n nh·ªãp tim	I49	R·ªëi lo·∫°n nh·ªãp tim	K√©o d√†i QT ‚Äì nguy c∆° rung th·∫•t
Atorvastatin	Atorvastatin	Ch·ªëng ch·ªâ ƒë·ªãnh	B·ªánh gan ho·∫°t ƒë·ªông	K76	B·ªánh gan kh√°c	TƒÉng men gan r√µ r·ªát ‚Äì kh√¥ng d√πng
Atorvastatin	Atorvastatin	Th·∫≠n tr·ªçng	Ng∆∞·ªùi u·ªëng nhi·ªÅu r∆∞·ª£u	F10.2	R·ªëi lo·∫°n do r∆∞·ª£u	Nguy c∆° ƒë·ªôc gan cao h∆°n ‚Äì c·∫ßn theo d√µi
Fenofibrate	Fenofibrate	Ch·ªëng ch·ªâ ƒë·ªãnh	Suy gan	K72	Suy gan	G√¢y r·ªëi lo·∫°n chuy·ªÉn h√≥a lipid ‚Äì tƒÉng ƒë·ªôc t√≠nh
Fenofibrate	Fenofibrate	Th·∫≠n tr·ªçng	Suy th·∫≠n	N18	Suy th·∫≠n m·∫°n	C·∫ßn hi·ªáu ch·ªânh li·ªÅu ‚Äì tr√°nh t√≠ch l≈©y
Aspirin	Acetylsalicylic acid	Ch·ªëng ch·ªâ ƒë·ªãnh	Lo√©t d·∫° d√†y t√° tr√†ng ti·∫øn tri·ªÉn	K25	Lo√©t d·∫° d√†y	Nguy c∆° ch·∫£y m√°u ti√™u h√≥a ‚Äì ch·ªëng ch·ªâ ƒë·ªãnh tuy·ªát ƒë·ªëi
Aspirin	Acetylsalicylic acid	Ch·ªëng ch·ªâ ƒë·ªãnh	Hen do aspirin	J45.0	Hen d·∫°ng nh·∫°y c·∫£m aspirin	Co th·∫Øt ph·∫ø qu·∫£n ‚Äì ng·ª´ng ngay
Clopidogrel	Clopidogrel	Th·∫≠n tr·ªçng	Ch·∫£y m√°u ƒëang di·ªÖn ti·∫øn	R58	Ch·∫£y m√°u	TƒÉng nguy c∆° xu·∫•t huy·∫øt ‚Äì ng∆∞ng n·∫øu kh√¥ng ki·ªÉm so√°t ƒë∆∞·ª£c
Clopidogrel	Clopidogrel	Th·∫≠n tr·ªçng	Suy gan n·∫∑ng	K72	Suy gan	C·∫ßn theo d√µi ch·ª©c nƒÉng ƒë√¥ng m√°u
Nitroglycerin	Nitroglycerin	Ch·ªëng ch·ªâ ƒë·ªãnh	Huy·∫øt √°p th·∫•p	I95	H·∫° huy·∫øt √°p	T·ª•t huy·∫øt √°p nghi√™m tr·ªçng ‚Äì kh√¥ng d√πng khi huy·∫øt √°p th·∫•p
Nitroglycerin	Nitroglycerin	Ch·ªëng ch·ªâ ƒë·ªãnh	D√πng chung v·ªõi thu·ªëc ·ª©c ch·∫ø PDE5	Z92.2	Ti·ªÅn s·ª≠ d√πng thu·ªëc	Nguy c∆° t·ª•t huy·∫øt √°p nghi√™m tr·ªçng n·∫øu ph·ªëi h·ª£p
Carbocisteine	Carbocisteine	Th·∫≠n tr·ªçng	Lo√©t d·∫° d√†y	K25	Lo√©t d·∫° d√†y	K√≠ch ·ª©ng ni√™m m·∫°c d·∫° d√†y ‚Äì d√πng th·∫≠n tr·ªçng
Pseudoephedrine	Pseudoephedrine hydrochloride	Ch·ªëng ch·ªâ ƒë·ªãnh	TƒÉng huy·∫øt √°p n·∫∑ng	I10	TƒÉng huy·∫øt √°p	Co m·∫°ch m·∫°nh ‚Äì tƒÉng huy·∫øt √°p h∆°n
Dextromethorphan	Dextromethorphan hydrobromide	Ch·ªëng ch·ªâ ƒë·ªãnh	Tr·∫ª em < 2 tu·ªïi	Z00.12	Kh√°m s·ª©c kh·ªèe tr·∫ª em	·ª®c ch·∫ø h√¥ h·∫•p ‚Äì kh√¥ng d√πng cho tr·∫ª nh·ªè
Phenylephrine	Phenylephrine hydrochloride	Ch·ªëng ch·ªâ ƒë·ªãnh	B·ªánh tim thi·∫øu m√°u c·ª•c b·ªô	I25	Thi·∫øu m√°u c∆° tim	TƒÉng co b√≥p ‚Äì l√†m n·∫∑ng tri·ªáu ch·ª©ng
Guaifenesin	Guaifenesin	Th·∫≠n tr·ªçng	Lo√©t d·∫° d√†y	K25	Lo√©t d·∫° d√†y	C√≥ th·ªÉ g√¢y k√≠ch ·ª©ng d·∫° d√†y n·∫øu d√πng li·ªÅu cao
Tetracycline	Tetracycline	Ch·ªëng ch·ªâ ƒë·ªãnh	Tr·∫ª < 8 tu·ªïi	Z00.12	Kh√°m s·ª©c kh·ªèe tr·∫ª em	L√†m h·ªèng men rƒÉng, ·∫£nh h∆∞·ªüng x∆∞∆°ng d√†i
Tetracycline	Tetracycline	Ch·ªëng ch·ªâ ƒë·ªãnh	Ph·ª• n·ªØ c√≥ thai	O26.8	Bi·∫øn ch·ª©ng thai k·ª≥	Qua nhau thai ‚Äì ·∫£nh h∆∞·ªüng men rƒÉng thai nhi
Ketoconazole	Ketoconazole	Th·∫≠n tr·ªçng	B·ªánh gan	K76	B·ªánh gan kh√°c	G√¢y tƒÉng men gan ‚Äì c·∫ßn theo d√µi men ALT/AST
Griseofulvin	Griseofulvin	Ch·ªëng ch·ªâ ƒë·ªãnh	B·ªánh gan c·∫•p	K71	Vi√™m gan do thu·ªëc	C√≥ th·ªÉ l√†m n·∫∑ng ƒë·ªôc t√≠nh gan ‚Äì kh√¥ng d√πng
Nystatin	Nystatin	Th·∫≠n tr·ªçng	D·ªã ·ª©ng v·ªõi n·∫•m	T78	Ph·∫£n ·ª©ng d·ªã ·ª©ng	Ghi nh·∫≠n ph·∫£n ·ª©ng ch√©o v·ªõi kh√°ng nguy√™n n·∫•m
Mephenesin	Mephenesin	Th·∫≠n tr·ªçng	Suy gan	K72	Suy gan	Chuy·ªÉn h√≥a qua gan ‚Äì c·∫ßn th·∫≠n tr·ªçng khi d√πng li·ªÅu cao
Mephenesin	Mephenesin	Th·∫≠n tr·ªçng	Ng∆∞·ªùi cao tu·ªïi	Z72.3	Ng∆∞·ªùi cao tu·ªïi	Nguy c∆° bu·ªìn ng·ªß, ch√≥ng m·∫∑t ‚Äì tƒÉng t√© ng√£
Nimodipin	Nimodipine	Ch·ªëng ch·ªâ ƒë·ªãnh	H·∫° huy·∫øt √°p n·∫∑ng	I95	H·∫° huy·∫øt √°p	T·ª•t huy·∫øt √°p m·∫°nh ‚Äì ng·ª´ng thu·ªëc n·∫øu HA < 90
Methyldopa	Methyldopa	Ch·ªëng ch·ªâ ƒë·ªãnh	B·ªánh gan ho·∫°t ƒë·ªông	K76	B·ªánh gan kh√°c	TƒÉng men gan, v√†ng da ‚Äì ch·ªëng ch·ªâ ƒë·ªãnh tuy·ªát ƒë·ªëi
Methyldopa	Methyldopa	Th·∫≠n tr·ªçng	Ng∆∞·ªùi cao tu·ªïi	Z72.3	Ng∆∞·ªùi cao tu·ªïi	Nguy c∆° an th·∫ßn qu√° m·ª©c ‚Äì gi·∫£m li·ªÅu n·∫øu c·∫ßn
Triamcinolone	Triamcinolone	Th·∫≠n tr·ªçng	ƒê√°i th√°o ƒë∆∞·ªùng	E14	ƒê√°i th√°o ƒë∆∞·ªùng	TƒÉng ƒë∆∞·ªùng huy·∫øt ‚Äì c·∫ßn theo d√µi glucose
Triamcinolone	Triamcinolone	Th·∫≠n tr·ªçng	Nhi·ªÖm khu·∫©n ch∆∞a ki·ªÉm so√°t	B99	Nhi·ªÖm tr√πng kh√¥ng ƒë·∫∑c hi·ªáu	Che l·∫•p tri·ªáu ch·ª©ng ‚Äì l√†m lan r·ªông nhi·ªÖm khu·∫©n
Hydrocortisone	Hydrocortisone	Th·∫≠n tr·ªçng	TƒÉng huy·∫øt √°p	I10	TƒÉng huy·∫øt √°p	C√≥ th·ªÉ g√¢y gi·ªØ n∆∞·ªõc ‚Äì tƒÉng huy·∫øt √°p th√™m
Hydrocortisone	Hydrocortisone	Ch·ªëng ch·ªâ ƒë·ªãnh	Nhi·ªÖm n·∫•m to√†n th√¢n	B49	Nhi·ªÖm n·∫•m kh√¥ng ƒë·∫∑c hi·ªáu	TƒÉng nguy c∆° t·ª≠ vong ‚Äì kh√¥ng d√πng corticoid to√†n th√¢n
Terpin	Terpin hydrate	Th·∫≠n tr·ªçng	Suy gan	K72	Suy gan	Th·∫£i tr·ª´ qua gan ‚Äì nguy c∆° t√≠ch l≈©y n·∫øu suy gan
K·∫Ωm gluconat	Zinc gluconate	Th·∫≠n tr·ªçng	Suy th·∫≠n	N18	Suy th·∫≠n m·∫°n	TƒÉng nguy c∆° t√≠ch l≈©y k·∫Ωm
Vitamin C li·ªÅu cao	Ascorbic acid ‚â• 1g/ng√†y	Th·∫≠n tr·ªçng	S·ªèi th·∫≠n	N20	S·ªèi th·∫≠n	TƒÉng oxalat ni·ªáu ‚Äì d·ªÖ k·∫øt tinh t·∫°o s·ªèi
Mephenesin	Mephenesin	Th·∫≠n tr·ªçng	Suy gan	K72	Suy gan	Chuy·ªÉn h√≥a qua gan ‚Äì c·∫ßn th·∫≠n tr·ªçng khi d√πng li·ªÅu cao
Mephenesin	Mephenesin	Th·∫≠n tr·ªçng	Ng∆∞·ªùi cao tu·ªïi	Z72.3	Ng∆∞·ªùi cao tu·ªïi	Nguy c∆° bu·ªìn ng·ªß, ch√≥ng m·∫∑t ‚Äì tƒÉng t√© ng√£
Nimodipin	Nimodipine	Ch·ªëng ch·ªâ ƒë·ªãnh	H·∫° huy·∫øt √°p n·∫∑ng	I95	H·∫° huy·∫øt √°p	T·ª•t huy·∫øt √°p m·∫°nh ‚Äì ng·ª´ng thu·ªëc n·∫øu HA < 90
Triamcinolone	Triamcinolone	Th·∫≠n tr·ªçng	ƒê√°i th√°o ƒë∆∞·ªùng	E14	ƒê√°i th√°o ƒë∆∞·ªùng	TƒÉng ƒë∆∞·ªùng huy·∫øt ‚Äì c·∫ßn theo d√µi glucose
Triamcinolone	Triamcinolone	Th·∫≠n tr·ªçng	Nhi·ªÖm khu·∫©n ch∆∞a ki·ªÉm so√°t	B99	Nhi·ªÖm tr√πng kh√¥ng ƒë·∫∑c hi·ªáu	Che l·∫•p tri·ªáu ch·ª©ng ‚Äì l√†m lan r·ªông nhi·ªÖm khu·∫©n
Hydrocortisone	Hydrocortisone	Th·∫≠n tr·ªçng	TƒÉng huy·∫øt √°p	I10	TƒÉng huy·∫øt √°p	C√≥ th·ªÉ g√¢y gi·ªØ n∆∞·ªõc ‚Äì tƒÉng huy·∫øt √°p th√™m
Hydrocortisone	Hydrocortisone	Ch·ªëng ch·ªâ ƒë·ªãnh	Nhi·ªÖm n·∫•m to√†n th√¢n	B49	Nhi·ªÖm n·∫•m kh√¥ng ƒë·∫∑c hi·ªáu	TƒÉng nguy c∆° t·ª≠ vong ‚Äì kh√¥ng d√πng corticoid to√†n th√¢n
Terpin	Terpin hydrate	Th·∫≠n tr·ªçng	Suy gan	K72	Suy gan	Th·∫£i tr·ª´ qua gan ‚Äì nguy c∆° t√≠ch l≈©y n·∫øu suy gan
K·∫Ωm gluconat	Zinc gluconate	Th·∫≠n tr·ªçng	Suy th·∫≠n	N18	Suy th·∫≠n m·∫°n	TƒÉng nguy c∆° t√≠ch l≈©y k·∫Ωm
Vitamin C li·ªÅu cao	Ascorbic acid ‚â• 1g/ng√†y	Th·∫≠n tr·ªçng	S·ªèi th·∫≠n	N20	S·ªèi th·∫≠n	TƒÉng oxalat ni·ªáu ‚Äì d·ªÖ k·∫øt tinh t·∫°o s·ªèi
CAO GINKGO	Ginkgo biloba extract	Ch·ªëng ch·ªâ ƒë·ªãnh	R·ªëi lo·∫°n ƒë√¥ng m√°u	D68	R·ªëi lo·∫°n ƒë√¥ng m√°u	C√≥ th·ªÉ l√†m tƒÉng nguy c∆° ch·∫£y m√°u ‚Äì ng∆∞ng tr∆∞·ªõc ph·∫´u thu·∫≠t
CAO GINKGO	Ginkgo biloba extract	Th·∫≠n tr·ªçng	D√πng chung v·ªõi aspirin	Z92.2	Ti·ªÅn s·ª≠ d√πng thu·ªëc	TƒÉng nguy c∆° xu·∫•t huy·∫øt n·ªôi s·ªç ‚Äì th·∫≠n tr·ªçng ph·ªëi h·ª£p
HOASTEX	Codein + Terpin + Alimemazin	Ch·ªëng ch·ªâ ƒë·ªãnh	ƒê√°i th√°o ƒë∆∞·ªùng	E14	ƒê√°i th√°o ƒë∆∞·ªùng	C√≥ ch·ª©a ƒë∆∞·ªùng ‚Äì tƒÉng glucose huy·∫øt
HOASTEX	Codein + Terpin + Alimemazin	Ch·ªëng ch·ªâ ƒë·ªãnh	Tr·∫ª em c√≥ ti·ªÅn s·ª≠ co gi·∫≠t	R56.0	Co gi·∫≠t do s·ªët	Alimemazin v√† codein c√≥ th·ªÉ k√≠ch th√≠ch th·∫ßn kinh trung ∆∞∆°ng
HOASTEX	Codein + Terpin + Alimemazin	Ch·ªëng ch·ªâ ƒë·ªãnh	D·ªã ·ª©ng th√†nh ph·∫ßn	T78	Ph·∫£n ·ª©ng d·ªã ·ª©ng	C·∫ßn khai th√°c k·ªπ ti·ªÅn s·ª≠ m·∫´n c·∫£m
IBUPROFEN	Ibuprofen	Ch·ªëng ch·ªâ ƒë·ªãnh	Lo√©t d·∫° d√†y t√° tr√†ng	K25	Lo√©t d·∫° d√†y	TƒÉng nguy c∆° xu·∫•t huy·∫øt ti√™u h√≥a
IBUPROFEN	Ibuprofen	Th·∫≠n tr·ªçng	TƒÉng huy·∫øt √°p	I10	TƒÉng huy·∫øt √°p	C√≥ th·ªÉ l√†m tƒÉng huy·∫øt √°p ‚Äì c·∫ßn theo d√µi
IBUPROFEN	Ibuprofen	Th·∫≠n tr·ªçng	Suy th·∫≠n	N18	Suy th·∫≠n m·∫°n	C√≥ th·ªÉ g√¢y ƒë·ªôc th·∫≠n ‚Äì ƒë·∫∑c bi·ªát ·ªü ng∆∞·ªùi l·ªõn tu·ªïi
ACTISO	Cynara scolymus	Ch·ªëng ch·ªâ ƒë·ªãnh	T·∫Øc ·ªëng m·∫≠t	K83.1	T·∫Øc ·ªëng m·∫≠t	TƒÉng ti·∫øt m·∫≠t ‚Äì kh√¥ng d√πng n·∫øu ƒë√£ t·∫Øc ngh·∫Ωn
RAU ƒê·∫ÆNG	Glinus oppositifolius	Th·∫≠n tr·ªçng	Huy·∫øt √°p th·∫•p	I95	H·∫° huy·∫øt √°p	C√≥ th·ªÉ l√†m t·ª•t huy·∫øt √°p th√™m ‚Äì c·∫ßn theo d√µi s√°t
NEUROTRIVIT	Vitamin B1 + B6 + B12	Th·∫≠n tr·ªçng	Qu√° li·ªÅu vitamin B6	T78	Ph·∫£n ·ª©ng d·ªã ·ª©ng / ƒë·ªôc t√≠nh	D√πng k√©o d√†i li·ªÅu cao B6 c√≥ th·ªÉ g√¢y vi√™m d√¢y th·∫ßn kinh ngo·∫°i bi√™n
ROSUVASTATIN	Rosuvastatin	Ch·ªëng ch·ªâ ƒë·ªãnh	B·ªánh gan ho·∫°t ƒë·ªông	K76	B·ªánh gan kh√°c	TƒÉng men gan ‚Äì kh√¥ng d√πng khi ALT > 3 l·∫ßn ULN
ROSUVASTATIN	Rosuvastatin	Th·∫≠n tr·ªçng	D√πng chung gemfibrozil	Z92.2	Ti·ªÅn s·ª≠ d√πng thu·ªëc	TƒÉng nguy c∆° ti√™u c∆° v√¢n ‚Äì c·∫ßn theo d√µi CK
AGIMLISIN 5	Lisinopril 5 mg	Ch·ªëng ch·ªâ ƒë·ªãnh	Ph√π m·∫°ch do ACEI	T78.3	Ph√π m·∫°ch	Ph·∫£n ·ª©ng ph√π m·∫°ch nghi√™m tr·ªçng ‚Äì kh√¥ng d√πng l·∫°i thu·ªëc c√πng nh√≥m
ATORVASTATIN 40	Atorvastatin 40 mg	Th·∫≠n tr·ªçng	B·ªánh gan	K76	B·ªánh gan kh√°c	C·∫ßn theo d√µi men gan ƒë·ªãnh k·ª≥ ‚Äì tƒÉng nguy c∆° ƒë·ªôc gan
LACISARTAN HCT 100/12.5	Irbesartan + Hydrochlorothiazide	Ch·ªëng ch·ªâ ƒë·ªãnh	Suy th·∫≠n n·∫∑ng	N18.5	B·ªánh th·∫≠n m·∫°n G5	G√¢y m·∫•t c√¢n b·∫±ng ƒëi·ªán gi·∫£i ‚Äì c·∫ßn hi·ªáu ch·ªânh li·ªÅu ho·∫∑c ng∆∞ng
CINNARIZIN	Cinnarizine	Th·∫≠n tr·ªçng	B·ªánh Parkinson	G20	Parkinson	C√≥ th·ªÉ l√†m n·∫∑ng tri·ªáu ch·ª©ng run v√† c·ª©ng
DIMENHYDRINAT	Dimenhydrinate	Th·∫≠n tr·ªçng	Glaucoma g√≥c ƒë√≥ng	H40	Glaucoma g√≥c ƒë√≥ng	TƒÉng √°p l·ª±c n·ªôi nh√£n ‚Äì c√≥ th·ªÉ g√¢y c∆°n c·∫•p
CARBAMAZEPIN 200 MG	Carbamazepine	Ch·ªëng ch·ªâ ƒë·ªãnh	Block nhƒ© th·∫•t ƒë·ªô 2 ho·∫∑c 3	I44.1	Block nhƒ© th·∫•t	G√¢y ch·∫≠m d·∫´n truy·ªÅn tim ‚Äì nguy c∆° ng·ª´ng tim
ATROPIN SULFAT	Atropin sulfate	Th·∫≠n tr·ªçng	TƒÉng nh√£n √°p	H40	Glaucoma g√≥c ƒë√≥ng	Ch·ªëng ch·ªâ ƒë·ªãnh t∆∞∆°ng ƒë·ªëi ‚Äì tƒÉng √°p l·ª±c n·ªôi nh√£n
KETOPROFEN EC DWP 100MG	Ketoprofen	Ch·ªëng ch·ªâ ƒë·ªãnh	Lo√©t d·∫° d√†y ti·∫øn tri·ªÉn	K25	Lo√©t d·∫° d√†y	TƒÉng nguy c∆° xu·∫•t huy·∫øt ti√™u h√≥a ‚Äì ch·ªëng ch·ªâ ƒë·ªãnh tuy·ªát ƒë·ªëi
VITAMIN C 500MG	Ascorbic acid	Th·∫≠n tr·ªçng	S·ªèi th·∫≠n	N20	S·ªèi th·∫≠n	Li·ªÅu cao c√≥ th·ªÉ l√†m tƒÉng oxalat ni·ªáu ‚Äì nguy c∆° k·∫øt tinh t·∫°o s·ªèi
D·∫¶U D√ÇN T·ªòC	Tinh d·∫ßu h·ªón h·ª£p d√¢n t·ªôc	Th·∫≠n tr·ªçng	Tr·∫ª s∆° sinh <6 th√°ng	Z00.12	Kh√°m s·ª©c kh·ªèe tr·∫ª em	Tinh d·∫ßu c√≥ th·ªÉ g√¢y co th·∫Øt thanh qu·∫£n ho·∫∑c ng∆∞ng th·ªü
GOLATADIN 60 MR	Loratadine 60 mg MR	Th·∫≠n tr·ªçng	Suy gan	K72	Suy gan	Chuy·ªÉn h√≥a qua gan ‚Äì gi·∫£m li·ªÅu ·ªü b·ªánh nh√¢n suy gan n·∫∑ng
BUKSER 600	Acetylcysteine 600 mg	Th·∫≠n tr·ªçng	Lo√©t d·∫° d√†y	K25	Lo√©t d·∫° d√†y	K√≠ch ·ª©ng d·∫° d√†y ‚Äì c·∫ßn d√πng sau ƒÉn v√† theo d√µi
HOMETEX	Menthol + Cineol + Eucalyptol + Tinh d·∫ßu g·ª´ng	Th·∫≠n tr·ªçng	Tr·∫ª < 30 th√°ng	Z00.12	Kh√°m s·ª©c kh·ªèe tr·∫ª em	Tinh d·∫ßu d·ªÖ g√¢y co th·∫Øt thanh qu·∫£n, ng·ª´ng th·ªü
VI√äN D·∫† D√ÄY CHOLAPAN OPC	Cao m·∫≠t heo + Ngh·ªá + Tr·∫ßn b√¨	Ch·ªëng ch·ªâ ƒë·ªãnh	T·∫Øc ·ªëng m·∫≠t	K83.1	T·∫Øc ·ªëng m·∫≠t	TƒÉng ti·∫øt m·∫≠t ‚Äì ch·ªëng ch·ªâ ƒë·ªãnh n·∫øu ƒë√£ t·∫Øc
MIZHO	Kim ti·ªÅn th·∫£o + U·∫•t kim + Ngh·ªá ƒëen	Th·∫≠n tr·ªçng	S·ªèi th·∫≠n canxi oxalat	N20	S·ªèi th·∫≠n	Theo d√µi k√≠ch th∆∞·ªõc s·ªèi ‚Äì tr√°nh d√πng k√©o d√†i n·∫øu kh√¥ng ƒë√°p ·ª©ng
TOBIDEX	Tobramycin + Dexamethason	Th·∫≠n tr·ªçng	Lo√©t gi√°c m·∫°c	H16.0	Vi√™m lo√©t gi√°c m·∫°c	Steroid l√†m n·∫∑ng nhi·ªÖm khu·∫©n ‚Äì c·∫ßn c√¢n nh·∫Øc l·ª£i √≠ch/nguy c∆°
VASCONCOR 2.5	Bisoprolol fumarate	Ch·ªëng ch·ªâ ƒë·ªãnh	Hen ph·∫ø qu·∫£n	J45	Hen	·ª®c ch·∫ø beta kh√¥ng ch·ªçn l·ªçc c√≥ th·ªÉ g√¢y co th·∫Øt ph·∫ø qu·∫£n
HYVALOR PLUS	Amlodipin + Valsartan + Hydrochlorothiazide	Ch·ªëng ch·ªâ ƒë·ªãnh	Ph·ª• n·ªØ c√≥ thai	O26.8	Bi·∫øn ch·ª©ng thai k·ª≥	TƒÉng nguy c∆° qu√°i thai, suy th·∫≠n thai nhi
AMRIAMID 200	Amisulpride 200 mg	Ch·ªëng ch·ªâ ƒë·ªãnh	U t·ªßy th∆∞·ª£ng th·∫≠n	C74	U t·ªßy th∆∞·ª£ng th·∫≠n	TƒÉng nguy c∆° c∆°n tƒÉng huy·∫øt √°p k·ªãch ph√°t ‚Äì ch·ªëng ch·ªâ ƒë·ªãnh tuy·ªát ƒë·ªëi
VACOBUFEN 400 SACHET	Ibuprofen 400 mg	Ch·ªëng ch·ªâ ƒë·ªãnh	Lo√©t d·∫° d√†y t√° tr√†ng	K25	Lo√©t d·∫° d√†y	TƒÉng nguy c∆° xu·∫•t huy·∫øt ti√™u h√≥a
DAFODIN	Diosmin + Hesperidin	Th·∫≠n tr·ªçng	Ph·ª• n·ªØ c√≥ thai 3 th√°ng ƒë·∫ßu	O09.0	Thai < 14 tu·∫ßn	Ch∆∞a ƒë·ªß d·ªØ li·ªáu ƒë·ªô an to√†n ‚Äì c√¢n nh·∫Øc d√πng n·∫øu c·∫ßn
VINPHAXICAM	Piroxicam beta-cyclodextrin	Ch·ªëng ch·ªâ ƒë·ªãnh	Lo√©t d·∫° d√†y t√° tr√†ng ti·∫øn tri·ªÉn	K25	Lo√©t d·∫° d√†y	NSAID g√¢y ƒë·ªôc ni√™m m·∫°c ‚Äì ch·ªëng ch·ªâ ƒë·ªãnh n·∫øu c√≥ ti·ªÅn s·ª≠ lo√©t
MIDATAN 500/62,5	Amoxicillin + Clavulanic acid	Th·∫≠n tr·ªçng	Suy gan	K72	Suy gan	TƒÉng men gan ‚Äì c·∫ßn theo d√µi ch·ª©c nƒÉng gan ƒë·ªãnh k·ª≥
OZANTA	Olanzapine	Th·∫≠n tr·ªçng	ƒê√°i th√°o ƒë∆∞·ªùng	E14	ƒê√°i th√°o ƒë∆∞·ªùng	TƒÉng ƒë∆∞·ªùng huy·∫øt ‚Äì c·∫ßn theo d√µi glucose m√°u th∆∞·ªùng xuy√™n
STADNEX 20 CAP	Esomeprazole 20 mg	Th·∫≠n tr·ªçng	Suy gan	K72	Suy gan	Gi·∫£m li·ªÅu ·ªü b·ªánh nh√¢n suy gan n·∫∑ng
REMINT-S FORT	Ginkgo biloba + Troxerutin + Heptaminol	Th·∫≠n tr·ªçng	R·ªëi lo·∫°n ƒë√¥ng m√°u	D68	R·ªëi lo·∫°n ƒë√¥ng m√°u	TƒÉng nguy c∆° ch·∫£y m√°u ‚Äì c·∫ßn theo d√µi n·∫øu d√πng chung aspirin/warfarin
SULFADIAZIN B·∫†C	Silver sulfadiazine	Ch·ªëng ch·ªâ ƒë·ªãnh	D·ªã ·ª©ng sulfonamid	T88.7	Ph·∫£n ·ª©ng d·ªã ·ª©ng v·ªõi thu·ªëc	Kh√¥ng d√πng n·∫øu ti·ªÅn s·ª≠ d·ªã ·ª©ng sulfa
FORDIA MR	Metformin + Gliclazide MR	Ch·ªëng ch·ªâ ƒë·ªãnh	Suy th·∫≠n n·∫∑ng	N18.5	B·ªánh th·∫≠n m·∫°n G5	TƒÉng nguy c∆° nhi·ªÖm toan lactic v√† h·∫° ƒë∆∞·ªùng huy·∫øt
APITIM 10	Atorvastatin 10 mg	Th·∫≠n tr·ªçng	Suy gan	K76	B·ªánh gan kh√°c	Theo d√µi men gan ALT/AST th∆∞·ªùng xuy√™n
KATRYPSIN FORT	Alpha chymotrypsin	Ch·ªëng ch·ªâ ƒë·ªãnh	D·ªã ·ª©ng protein	T78	Ph·∫£n ·ª©ng d·ªã ·ª©ng	C√≥ th·ªÉ g√¢y ph·∫£n v·ªá ‚Äì ƒë·∫∑c bi·ªát ng∆∞·ªùi d·ªã ·ª©ng enzyme
GIKANIN	Ginkgo biloba + B1 + B6 + B12	Th·∫≠n tr·ªçng	R·ªëi lo·∫°n ƒë√¥ng m√°u	D68	R·ªëi lo·∫°n ƒë√¥ng m√°u	TƒÉng nguy c∆° ch·∫£y m√°u n·∫øu ph·ªëi h·ª£p thu·ªëc kh√°ng ƒë√¥ng
CEFACLOR 125MG	Cefaclor 125 mg	Th·∫≠n tr·ªçng	Suy th·∫≠n	N18	Suy th·∫≠n m·∫°n	Hi·ªáu ch·ªânh li·ªÅu ‚Äì nguy c∆° t√≠ch l≈©y
LAMIVUDIN HASAN 150	Lamivudine	Th·∫≠n tr·ªçng	Suy gan	K72	Suy gan	C·∫ßn theo d√µi ch·ª©c nƒÉng gan n·∫øu c√≥ vi√™m gan m·∫°n t√≠nh
SA VILEUCIN	Acetyl leucine	Th·∫≠n tr·ªçng	Ph·ª• n·ªØ c√≥ thai	O26.8	Bi·∫øn ch·ª©ng thai k·ª≥	Ch∆∞a c√≥ d·ªØ li·ªáu an to√†n ƒë·∫ßy ƒë·ªß ‚Äì c√¢n nh·∫Øc l·ª£i √≠ch/nguy c∆°
THELIZIN	Cetirizine + Pseudoephedrine	Ch·ªëng ch·ªâ ƒë·ªãnh	TƒÉng huy·∫øt √°p n·∫∑ng	I10	TƒÉng huy·∫øt √°p	Co m·∫°ch m·∫°nh ‚Äì c√≥ th·ªÉ l√†m n·∫∑ng tƒÉng huy·∫øt √°p
DOPOLYS - S	Acetylcysteine + Loratadin	Th·∫≠n tr·ªçng	Lo√©t d·∫° d√†y	K25	Lo√©t d·∫° d√†y	C·∫ßn d√πng sau ƒÉn ‚Äì tr√°nh k√≠ch ·ª©ng ni√™m m·∫°c
Omeprazol	Omeprazole	Th·∫≠n tr·ªçng	Suy gan n·∫∑ng	K72	Suy gan	C·∫ßn hi·ªáu ch·ªânh li·ªÅu ‚Äì tƒÉng nguy c∆° t√≠ch l≈©y thu·ªëc
Omeprazol	Omeprazole	Th·∫≠n tr·ªçng	D√πng k√©o d√†i >12 tu·∫ßn	E83.5	R·ªëi lo·∫°n chuy·ªÉn h√≥a calci	Nguy c∆° lo√£ng x∆∞∆°ng, g√£y x∆∞∆°ng ‚Äì b·ªï sung canxi khi c·∫ßn
Omeprazol	Omeprazole	Th·∫≠n tr·ªçng	Nhi·ªÖm H. pylori kh√¥ng ƒëi·ªÅu tr·ªã	K29.5	Vi√™m d·∫° d√†y m·∫°n	Kh√¥ng d√πng ƒë∆°n ƒë·ªôc k√©o d√†i ‚Äì c·∫ßn ph·ªëi h·ª£p kh√°ng sinh n·∫øu H. pylori d∆∞∆°ng t√≠nh
Omeprazol	Omeprazole	Th·∫≠n tr·ªçng	S·ª≠ d·ª•ng ƒë·ªìng th·ªùi v·ªõi Clopidogrel	Z92.2	Ti·ªÅn s·ª≠ d√πng thu·ªëc	T∆∞∆°ng t√°c l√†m gi·∫£m t√°c d·ª•ng kh√°ng ti·ªÉu c·∫ßu c·ªßa Clopidogrel
Omeprazol	Omeprazole	Ch·ªëng ch·ªâ ƒë·ªãnh	D·ªã ·ª©ng v·ªõi d·∫´n xu·∫•t benzimidazol	T78	Ph·∫£n ·ª©ng d·ªã ·ª©ng	C·∫ßn h·ªèi k·ªπ ti·ªÅn s·ª≠ d·ªã ·ª©ng thu·ªëc h·ªç PPI
Alpha chymotrypsin	AlphaCHY	Ch·ªëng ch·ªâ ƒë·ªãnh	Vi√™m lo√©t d·∫° d√†y t√° tr√†ng ti·∫øn tri·ªÉn	K25‚ÄìK28	Lo√©t d·∫° d√†y ‚Äì t√° tr√†ng	C√≥ th·ªÉ g√¢y xu·∫•t huy·∫øt do ho·∫°t t√≠nh enzyme ti√™u protein
Alpha chymotrypsin	AlphaCHY	Th·∫≠n tr·ªçng	B·ªánh gan n·∫∑ng, ng∆∞·ªùi ƒëang ch·∫£y m√°u	R58	Ch·∫£y m√°u ch∆∞a x√°c ƒë·ªãnh nguy√™n nh√¢n	TƒÉng nguy c∆° ch·∫£y m√°u do ·∫£nh h∆∞·ªüng ƒë√¥ng m√°u
Alpha chymotrypsin	AlphaCHY	Ch·ªëng ch·ªâ ƒë·ªãnh	D·ªã ·ª©ng v·ªõi protein t·ª´ b√≤ ho·∫∑c alpha-trypsin	T78.1	Ph·∫£n ·ª©ng d·ªã ·ª©ng v·ªõi th·ª©c ƒÉn	Nguy c∆° ph·∫£n v·ªá, n√™n h·ªèi k·ªπ ti·ªÅn s·ª≠ d·ªã ·ª©ng

            Tr·∫£ l·ªùi theo format JSON nghi√™m ng·∫∑t, kh√¥ng c√≥ vƒÉn b·∫£n n√†o kh√°c ngo√†i JSON:
            {
              "summary": "T√≥m t·∫Øt l√Ω do ch√≠nh trong m·ªôt c√¢u, v√≠ d·ª•: Ch·∫©n ƒëo√°n kh√¥ng ph√π h·ª£p v·ªõi ch·ªâ ƒë·ªãnh c·ªßa thu·ªëc.",
              "details": ["Gi·∫£i th√≠ch chi ti·∫øt v√† ƒë∆∞a ra v√≠ d·ª• v·ªÅ ch·ªëng ch·ªâ ƒë·ªãnh, t∆∞∆°ng t√°c thu·ªëc, thu·ªëc kh√¥ng ph√π h·ª£p ƒë·ªô tu·ªïi..."]
            }
            `;
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${geminiApiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || `L·ªói API: ${response.status}`);
                }
                const data = await response.json();
                const parsedResult = JSON.parse(data.candidates[0].content.parts[0].text);
                // ƒê·∫£m b·∫£o k·∫øt qu·∫£ lu√¥n c√≥ 2 tr∆∞·ªùng d·ªØ li·ªáu ƒë·ªÉ tr√°nh l·ªói
                return {
                    summary: parsedResult.summary || "Kh√¥ng c√≥ t√≥m t·∫Øt.",
                    details: parsedResult.details || []
                };
            } catch (error) {
                console.error("L·ªói khi g·ªçi ho·∫∑c ph√¢n t√≠ch c√∫ ph√°p Gemini API:", error);
                throw new Error('Kh√¥ng th·ªÉ ph√¢n t√≠ch t·ª´ Gemini. ' + error.message);
            }
        }

        function updateFacilityStatus(cskcb) {
            const statusCell = document.getElementById(`status-${cskcb}`);
            if (!statusCell) return;
            const totalRows = rawDataByCSKCB[cskcb]?.length || 0;
            const analyzedCount = Object.keys(analysisResults[cskcb] || {}).length;
            if (analyzedCount === 0) {
                statusCell.innerHTML = `<span class="badge bg-secondary">Ch∆∞a ph√¢n t√≠ch</span>`;
            } else if (analyzedCount < totalRows) {
                statusCell.innerHTML = `<div class="progress" role="progressbar" style="height: 20px;">
                    <div class="progress-bar progress-bar-striped progress-bar-animated bg-warning text-dark" style="width: ${analyzedCount/totalRows*100}%"><b>${analyzedCount}/${totalRows}</b></div>
                </div>`;
            } else {
                statusCell.innerHTML = `<span class="badge bg-success">‚úÖ ƒê√£ ph√¢n t√≠ch xong</span>`;
            }
        }
    </script>
</body>
</html>
